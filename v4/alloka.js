function geoInit(){"undefined"!=typeof _alloka&&_alloka.use_geo&&"https:"===location.protocol&&geoSubstitute()}function getProtocol(){return allokaWhiteLabelScript?allokaDevelopment?"http://":"https://":"undefined"!=typeof _alloka?("undefined"==typeof _alloka.server_host&&(_alloka.server_host=allokaDevelopment?"127.0.0.1:3000":allokaDefaultServerHost),_alloka.server_host==allokaDefaultServerHost?"https://":"http://"):"https://"}function allokaGetProtocol(){return getProtocol()}function loadModal(){if("undefined"!=typeof _alloka&&"undefined"==typeof _alloka.dont_use_modal){var e=getProtocol(),t=document.createElement("link");if(t.rel="stylesheet",t.type="text/css",allokaWhiteLabelScript)var n=_alloka.server_host;else if("undefined"==typeof _alloka||"undefined"==typeof _alloka.server_host)var n=allokaDefaultServerHost;else var n=_alloka.server_host;t.href=e+n+"/assets/modal.css",document.getElementsByTagName("head")[0].appendChild(t)}}function geoSubstitute(){function e(e){var t=e.coords.latitude,n=e.coords.longitude;_alloka.coordinates=[t,n],allokaSubstitute()}function t(){console.log("Unable to retrieve your location")}if(!navigator.geolocation)return void t();navigator.geolocation.getCurrentPosition(e,t,{timeout:2e4})}function leaveFeedback(e){var t=new XMLHttpRequest,n=getProtocol();t.open("POST",n+_alloka.server_host+"/api/site/feedback/",!0),t.setRequestHeader("Content-type","application/json"),e=JSON.stringify(e),t.send(e)}function AllokaId(e){var t=new XMLHttpRequest,n=getProtocol();allokaWhiteLabelScript&&allokaAllokaIdMigrateWhiteLabel(),t.open("POST",n+_alloka.server_host+allokaAllokaIdPath,!0),t.setRequestHeader("Content-type","application/json"),e[allokaAllokaIdReq]=function(){try{return allokaGetCookie(allokaAllokaIdCookieName)||""}catch(e){return""}}(),e.utma=allokaGetCookie("__utma"),e.utmb=allokaGetCookie("__utmb"),e.utmz=allokaGetCookie("__utmz"),e.location=decodeURI(document.location.toString()),window.request_data=e;var o=JSON.stringify(e);t.onreadystatechange=function(){t.readyState==XMLHttpRequest.DONE&&200==t.status&&(response=JSON.parse(t.response),allokaSetCookie(allokaAllokaIdCookieName,response[allokaAllokaIdRes],365),build_email_tracking_form(e.oid))},t.send(o)}function allokaInit(){try{if("undefined"!=typeof _alloka){if("undefined"!=typeof _alloka.event_binded)return void allokaDebug("allokaInit: event binded: exiting...");_alloka.event_binded=!0,"undefined"==typeof _alloka.auto_substitute&&(_alloka.auto_substitute=!0),_alloka.auto_substitute&&allokaSubstitute()}else allokaLanding()}catch(e){allokaLog(e)}}function allokaModal(e){Modal.open({content:e,width:"60%"})}function allokaSubscribe(e){if("undefined"!=typeof Faye){var t,n=getProtocol();t=allokaDevelopment?new Faye.Client("http://"+_alloka.server_host.replace(/:\d+$/,"")+":9292/faye"):allokaWhiteLabelScript?new Faye.Client(n+_alloka.server_host+"/ws/faye"):new Faye.Client(n+_alloka.server_host+"/faye");try{t.unsubscribe("/client_notifications/"+e.session_id),t.unsubscribe("/client_notifications_js/"+e.session_id),t.unsubscribe("/client_actions/"+e.session_id)}catch(e){allokaLog(e)}t.unsubscribe("/session/"+e.session_id),t.subscribe("/session/"+e.session_id),e.need_client_actions&&t.subscribe("/client_actions/"+e.session_id,function(t){allokaShowRatingModal(Object.assign(t,{session_id:e.session_id,oid:e.oid,lang:_alloka.lang||"ru"}))}),e.feedback_popup_enabled&&t.subscribe("/client_notifications/"+e.session_id,function(e){allokaModal(e)}),(e.feedback_js_enabled||e.metrika_enabled||e.vk_enabled)&&t.subscribe("/client_notifications_js/"+e.session_id,function(e){var t=window[e.name];"function"==typeof t&&t(e.params)})}else console.log("Faye is undefined")}function allokaDebugParamExists(){var e=allokaGetUrlParameters(document.location.search.substr(1));return e?e._alloka_debug:undefined}function allokaDontSubstituteParamExists(){var e=allokaGetUrlParameters(document.location.search.substr(1));return e?e._alloka_dont_substitute:undefined}function allokaContains(e,t){return function(e){var t,n=e!==e;return t=n||"function"!=typeof Array.prototype.indexOf?function(e){var t=-1,o=-1;for(t=0;t<this.length;t++){var a=this[t];if(n&&a!==a||a===e){o=t;break}}return o}:Array.prototype.indexOf,t.call(this,e)>-1}.call(e,t)}function allokaMatchHostname(e){return new RegExp("(^|.)"+e.replace(/\./,".")+"$","").test(document.location.hostname)}function allokaIsNewSendGaClientId(){for(var e=allokaIsNewSendGaClientIdList.length,t=!1,n=0;n<e;n++)if(allokaMatchHostname(allokaIsNewSendGaClientIdList[n])){t=!0;break}return t}function allokaWaitFor(e,t){var n=setInterval(function(){e()&&(clearInterval(n),t())},300)}function allokaBindToMetrika(){return!allokaGetYandexClientId()&&(allokaWaitFor(function(){return allokaGetYandexClientId()},function(){allokaSubstitute()}),!0)}function allokaSubstitute(){try{var e,t,n,o,a="aa_v4_";if("undefined"==typeof _alloka)return!1;if("undefined"==typeof _alloka.debug&&allokaDebugParamExists()&&(_alloka.debug=!0),"undefined"==typeof _alloka.dont_substitute&&allokaDontSubstituteParamExists()&&(_alloka.dont_substitute=!0),_alloka.dont_substitute)return void allokaDebug("don't substitute");if(allokaDebug("substitute"),_alloka.bind_to_metrika&&(allokaDebug("bind to metrika"),allokaBindToMetrika()))return;allokaIsNewSendGaClientId()?allokaNewSendGaClientId():allokaOnLoad(allokaSendGaClientId),allokaOnLoad(allokaSendYandexClientId),window.allokaSendRoistatId&&allokaOnLoad(allokaSendRoistatId),"undefined"==typeof _alloka.server_host&&(_alloka.server_host=allokaDefaultServerHost),"undefined"==typeof _alloka.last_source&&(_alloka.last_source=!1),_alloka.is_mobile=allokaIsMobile(),_alloka.cookie_prefix=a,allokaIsArray(_alloka.trackable_source_types)||(_alloka.trackable_source_types=["typein","type_in","referrer","utm"]);var i=null,r=0;if(_alloka.ordered_objects){i=[];for(var s in _alloka.objects)_alloka.objects[s].oid=s,i[_alloka.objects[s].ordered_index]=_alloka.objects[s]}t=allokaGetReferrer(),n=allokaGetSearch(),allokaDebug("loop objects...");for(var s in _alloka.objects){var l,c,d,u,f;if(allokaDebug("loop("+s+")"),l=_alloka.objects[s],l.oid=s,_alloka.ordered_objects&&(l=i[r],r+=1),o=_alloka.cookie_prefix+l.oid,"undefined"==typeof l.format&&(l.format="+7 (#{XXX}) #{XXX}-#{XX}-#{XX}"),"undefined"==typeof l.block_class&&(l.block_class="phone_alloka"),"undefined"==typeof l.is_fixed_number&&(l.is_fixed_number=!1),0!=allokaGetElementsByClassName(l.block_class).length){if(allokaSetValueToBlocksByClass(l.block_class,"",l),(e=allokaGetCookie(_alloka.cookie_prefix+"number_"+l.oid))&&""!=typeof e?(l.cached_number=e,allokaSetValueToBlocksByClass(l.block_class,l.cached_number,l)):"undefined"!=typeof l.default_number&&allokaSetValueToBlocksByClass(l.block_class,l.default_number,l),e=allokaGetCookie(o))try{e=JSON.parse(Base64.decode(e)),allokaIsArray(e)&&"undefined"!=typeof e[0]&&allokaIsString(e[0])&&32===e[0].length?l.session_id=e[0].length?e[0]:allokaGenerateSessionId():e=undefined}catch(t){e=undefined}void 0===e&&(allokaDebug("generate undefined cookie"),l.session_id=allokaGenerateSessionId(),e=Base64.encode(JSON.stringify([l.session_id])),allokaSetCookie(o,e,1)),allokaIsArray(l.trackable_source_types)?(d=l.trackable_source_types.indexOf("typein")>-1||l.trackable_source_types.indexOf("type_in")>-1,u=l.trackable_source_types.indexOf("referrer")>-1,f=l.trackable_source_types.indexOf("utm")>-1):(d=_alloka.trackable_source_types.indexOf("typein")>-1||_alloka.trackable_source_types.indexOf("type_in")>-1,u=_alloka.trackable_source_types.indexOf("referrer")>-1,f=_alloka.trackable_source_types.indexOf("utm")>-1);var h=!1,p=!1;if(h=t&&t.length>0,n&&n.length>0){var _=allokaGetUrlParameters(n);if(allokaGetObjectSize(_))for(var y in _)if(y.indexOf("utm_")>-1){p=!0;break}}if(allokaSourceTracked(d,u,f,h,p)){if("undefined"!=typeof _alloka.url_params&&!allokaCheckParams(n,_alloka.url_params)||"undefined"!=typeof l.url_params&&!allokaCheckParams(n,l.url_params)||"undefined"!=typeof _alloka.deny_on_url_params&&allokaCheckParams(n,_alloka.deny_on_url_params)||"undefined"!=typeof l.deny_on_url_params&&allokaCheckParams(n,l.deny_on_url_params))allokaSetValueToBlocksByClass(l.block_class,undefined,l);else if("undefined"!=typeof _alloka.referrer_domains&&(!h||!allokaCheckDomain(t,_alloka.referrer_domains))||"undefined"!=typeof l.referrer_domains&&(!h||!allokaCheckDomain(t,l.referrer_domains))||h&&"undefined"!=typeof _alloka.deny_on_referrer_domains&&allokaCheckDomain(t,_alloka.deny_on_referrer_domains)||h&&"undefined"!=typeof l.deny_on_referrer_domains&&allokaCheckDomain(t,l.deny_on_referrer_domains))allokaSetValueToBlocksByClass(l.block_class,undefined,l);else if(c={oid:l.oid,session_id:l.session_id},_alloka.custom_data&&"object"==typeof _alloka.custom_data&&(c.custom_data=_alloka.custom_data),_alloka.url_parameters&&"object"==typeof _alloka.url_parameters&&(c.url_parameters=allokaGetUrlParameters(decodeURI(document.location.search.substr(1)),_alloka.url_parameters),"object"!=typeof c.url_parameters&&delete c.url_parameters),t&&t.length>0&&(c.referrer=t.slice(0,150)),n&&n.length>0&&(c.search=n),"undefined"==typeof _alloka.coordinates&&(_alloka.coordinates=!1),_alloka.coordinates&&_alloka.coordinates.length>0&&(c.coordinates=_alloka.coordinates),c.city=_alloka.city,AllokaId(c),allokaMakeRequest("/api/site/retrieve_number",c,allokaHandleResponse),alloka_session=allokaGetCookie(allokaSessionCookieName),alloka_session||allokaSetCookie(allokaSessionCookieName,Base64.encode(JSON.stringify(c))),l.stop_on_match){allokaDebug("stopped on match"),allokaDebug(l.oid);break}}else allokaSetValueToBlocksByClass(l.block_class,undefined,l)}else allokaDebug("allokaSubstitute: no elements: continue..")}}catch(e){allokaLog(e)}}function allokaSourceTracked(e,t,n,o,a){var i=e&&!o&&!a,r=t&&o&&!a,s=n&&a;return i||r||s}function allokaSendGaClientIdObj(e,t){var n,o=_alloka.objects[e];"undefined"!=typeof o.success&&0!=o.success&&"undefined"!=typeof o.session_id&&("undefined"!=typeof o.is_fixed_number&&1==o.is_fixed_number||(n={aid:allokaGetCookie(allokaAllokaIdCookieName),oid:o.oid,session_id:o.session_id,ga_client_id:t},allokaMakeRequest("/api/site/set_ga_client_id",n,allokaHandleGaResponse)))}function allokaSendGaClientIdObjDefer(e,t){allokaDefer(e,function(){allokaSendGaClientIdObj(e,t)})}function allokaNewSendGaClientId(){allokaNewSendGaClientIdLimit(0)}function allokaNewSendGaClientIdLimit(e){var t;t=allokaDevelopment?1:60,"undefined"!=typeof ga?allokaSendGaClientId():e<t?setTimeout(function(){allokaNewSendGaClientIdLimit(e+1)},1e3):allokaSendGaClientId()}function allokaSendYandexClientId(){try{if("object"!=typeof _alloka)return;var e=500,t=120,n=0,o=setInterval(function(){var e=allokaGetYandexClientId();if(void 0!==e&&null!==e&&e.length>0){for(var a in _alloka.objects)allokaSendCustomDataDefer(a,{yandex_uid:e});return clearInterval(o)}if((n+=1)==t)return clearInterval(o)},e)}catch(e){allokaLog(e)}}function allokaSendGaClientId(){try{if("object"!=typeof _alloka)return;allokaWaitFor(function(){return allokaGetGaClientId()},function(){for(var e in _alloka.objects)allokaSendGaClientIdObjDefer(e,allokaGetGaClientId())})}catch(e){allokaLog(e)}}function allokaDeferPush(e,t){"object"!=typeof _alloka_defer[e]&&(_alloka_defer[e]=[]),_alloka_defer[e].push(t)}function allokaDefer(e,t){_alloka.objects[e].success&&t(),allokaDeferPush(e,t)}function allokaExecute(e){if(_alloka_defer[e])for(var t in _alloka_defer[e])_alloka_defer[e].hasOwnProperty(t)&&_alloka_defer[e][t]()}function allokaSendCustomDataDefer(e,t){allokaDefer(e,function(){allokaSendCustomDataOrig(e,t)})}function allokaSendCustomDataOrig(e,t){var n,o=_alloka.objects[e];try{if(!o.success||!o.session_id||!0===o.is_fixed_number)return;n=t||_alloka.custom_data,request_data={aid:allokaGetCookie(allokaAllokaIdCookieName),oid:o.oid,session_id:o.session_id,custom_data:n},void 0!==n&&allokaMakeRequest("/api/site/set_custom_data",request_data,allokaHandleCsResponse)}catch(e){allokaLog(e)}}function allokaSendCarrotId(e){var t=e,n=500,o=120,a=0,i=setInterval(function(){var e=allokaGetCookie("carrotquest_uid");return e?(allokaSendCustomData(t,{carrot_uid:e}),clearInterval(i)):(a+=1,10==a&&allokaLog("carrot_uid not met, period 5",_alloka.objects[t]),30==a&&allokaLog("carrot_uid not met, period 15",_alloka.objects[t]),a==o?(allokaLog("carrot_uid not met, period 60",_alloka.objects[t]),clearInterval(i)):void 0)},n)}function allokaPushVkGoal(e){VK.Retargeting.Event(e)}function allokaHandleCsResponse(e,t){try{if(200==t||422==t)if(allokaIsObject(e))e;else{if(!allokaIsString(e)||!allokaJsonAvailable())throw"unable_to_parse_response";JSON.parse(e)}}catch(e){allokaLog(e)}}function allokaHandleGaResponse(e,t,n){try{if(_alloka.objects[n],200==t||422==t)if(allokaIsObject(e))e;else{if(!allokaIsString(e)||!allokaJsonAvailable())throw"unable_to_parse_response";JSON.parse(e)}}catch(e){allokaLog(e)}}function allokaLanding(){try{var e,t,n,o,a="alloka_link",i=document.getElementsByClassName(a);if(i.length){if(o="aa_v4_"+"landing",e=allokaGetCookie(o))try{e=JSON.parse(Base64.decode(e)),allokaIsArray(e)&&e.length>=2?(t="undefined"!=typeof e[0]&&allokaIsString(e[0])&&e[0].length>0&&allokaReferrerIsValid(e[0])?e[0]:undefined,n="undefined"!=typeof e[1]&&allokaIsString(e[1])&&e[1].length>0?e[1]:undefined):e=undefined}catch(t){e=undefined}if(void 0===e&&(t=document.referrer.length>0&&allokaReferrerIsValid(document.referrer)?document.referrer:undefined,n=document.location.search&&document.location.search.length?decodeURI(document.location.search.substr(1)):undefined,e=Base64.encode(JSON.stringify([t,n])),allokaSetCookie(o,e,1)),n&&n.length&&(n="alloka_search="+escape(n)),t&&t.length&&(n=(n&&n.length?n+"&":"")+"alloka_referrer="+escape(t)),n&&n.length)for(block in i)if("object"==typeof i[block]){var r,s,l,c,d;r=i[block],s=r.getAttribute("href"),d=r.getAttribute("onclick"),l=s&&s.length?s+(-1==s.indexOf("?")?"?":"&")+n:"?"+n,c="this.setAttribute('href', '"+l+"')",d&&d.length?(d=d.replace(s,l),r.setAttribute("onclick",c+"; "+d)):r.setAttribute("onclick",c)}}}catch(e){allokaLog(e)}}function allokaGetUrlParameters(e,t){var n,o={};if(e&&allokaIsString(e)&&e.length>0){n=e.split("&");for(var a=0;a<n.length;a++){var i=n[a].split("=");o[i[0]]=i[1]}}if("object"==typeof t){var r={};for(var a in o)t.indexOf(a)>=0&&(r[a]=o[a]);o=r}var s=0;for(var a in o)s++;return 0==s?undefined:o}function allokaCheckParams(e,t){if(allokaIsArray(t)){var n=allokaGetUrlParameters(e,t);return allokaGetObjectSize(n)==allokaGetObjectSize(t)}if(allokaIsObject(t)){var o=allokaGetObjectKeys(t),n=allokaGetUrlParameters(e,o);if(allokaIsObject(n)&&allokaGetObjectSize(n)==allokaGetObjectSize(t)){for(var a in t){if(allokaIsArray(t[a])){for(var i in t[a])if("undefined"!=typeof t[a][i]&&"undefined"!=typeof n[a]&&t[a][i].toString()==n[a].toString())return!0;return!1}if("undefined"==typeof t[a]||"undefined"==typeof n[a]||t[a].toString()!=n[a].toString())return!1}return!0}return!1}return!1}function allokaGetReferrer(){var e,t=allokaGetCookie(_alloka.cookie_prefix+"referrer");return t?(t=Base64.decode(t),void 0!==t&&allokaIsString(t)?(e=t,!0==!!_alloka.last_source&&e!==document.referrer&&document.referrer.indexOf(location.host)<0&&(allokaReferrerIsValid(document.referrer)||allokaParseSearch())&&(e=document.referrer,allokaSetReferrer(e),allokaSetSearch(allokaParseSearch())),allokaReferrerIsValid(e)||(e=undefined)):e=undefined):("undefined"!=typeof landing_params&&allokaIsObject(landing_params)&&landing_params.alloka_referrer?e=unescape(landing_params.alloka_referrer):allokaReferrerIsValid(document.referrer)&&(e=document.referrer),allokaIsString(e)&&(allokaSetReferrer(e),!0==!!_alloka.last_source&&allokaSetSearch(allokaParseSearch()))),e}function allokaSetReferrer(e){allokaSetCookie(_alloka.cookie_prefix+"referrer",Base64.encode(e),1)}function allokaParseSearch(){var e;if("undefined"!=typeof landing_params&&allokaIsObject(landing_params)&&landing_params.alloka_search?e=unescape(landing_params.alloka_search):document.location.search&&document.location.search.length>0&&(e=decodeURI(document.location.search.substr(1))),location.hash.indexOf("?")){var t=location.hash.substr(location.hash.indexOf("?")+1);e===undefined?e=t:e+="&"+t}return e}function allokaGetSearch(){var e,t;return(t=allokaGetCookie(_alloka.cookie_prefix+"search"))?(t=Base64.decode(t),e=void 0!==t&&allokaIsString(t)&&t.length>0?t:undefined):(e=allokaParseSearch(),allokaIsString(e)&&allokaSetSearch(e)),e}function allokaSetSearch(e){allokaSetCookie(_alloka.cookie_prefix+"search",Base64.encode(e),1)}function allokaGetDomainFromUrl(e){var t,n=e.match(/^(http|https)?\:\/\/([^\/?#]+)?(?:[\/?#]|$)/i);return allokaIsArray(n)&&n[2].length>0?(t=n[2],-1!=t.indexOf(":")&&(t=t.split(":").shift()),0==t.indexOf("www.")&&(t=t.substr(4)),t):null}function allokaCheckDomain(e,t){var n=allokaGetDomainFromUrl(e);if(allokaIsArray(t)){for(var o in t)if(allokaSameDomain(n,t[o]))return!0}else if(allokaIsString(t))return allokaSameDomain(n,t);return!1}function allokaSameDomain(e,t){return e==t||"www."+e==t||e=="www."+t}function allokaSetCookie(e,t,n){if(n===undefined)document.cookie=e+"="+escape(t)+"; path=/;";else{var o=new Date;o.setDate(o.getDate()+n),document.cookie=e+"="+escape(t)+";expires="+o+"; path=/;"}}function allokaGetCookie(e){var t,n,o,a=document.cookie.split(";");for(t=0;t<a.length;t++)if(n=a[t].substr(0,a[t].indexOf("=")),o=a[t].substr(a[t].indexOf("=")+1),(n=n.replace(/^\s+|\s+$/g,""))==e)return unescape(o);return undefined}function allokaMakeRequest(e,t,n,o){if(!allokaJsonAvailable())throw"unsupported_browser";var a,i,r;if(o=o||1e4,"object"!=typeof t&&(t={}),t.oid&&(a=_alloka.objects[t.oid]),t.location=decodeURI(document.location.toString()),allokaDetectCORS(),1)if(1==allokaDetectCORS()){if("string"!=typeof(t=JSON.stringify(t))||t.length<=0)throw"json_stringify_failure";var s=getProtocol();i=s+_alloka.server_host+e;for(var l=[function(){return new XMLHttpRequest},function(){return new ActiveXObject("Msxml2.XMLHTTP")},function(){return new ActiveXObject("Msxml3.XMLHTTP")},function(){return new ActiveXObject("Microsoft.XMLHTTP")}],c=0;c<l.length;c++){try{r=l[c]()}catch(e){continue}break}if(!r)return;r.open("POST",i,!0),r.timeout=o,r.setRequestHeader("Content-Type","application/json"),r.setRequestHeader("Accept","application/json"),r.onreadystatechange=function(){4==r.readyState&&n&&"function"==typeof n&&n(r.responseText,r.status,a.oid)},r.onerror=function(){allokaLog("request failed to "+i),"undefined"==typeof t.ga_client_id&&(a.failure=!0,allokaSetValueToBlocksByClass(a.block_class,undefined,a))},r.ontimeout=function(){allokaLog("request timeout to "+i),"undefined"==typeof t.ga_client_id&&(a.failure=!0,allokaSetValueToBlocksByClass(a.block_class,undefined,a))},r.send(t)}else{i=allokaGetProtocol()+_alloka.server_host+e+"?callback="+n.toString().match(/^function\s*([^\s(]+)/)[1],i+="&data="+Base64.encode(JSON.stringify(t));var d=document.createElement("script");d.type="text/javascript",d.src=i,document.getElementsByTagName("head")[0].appendChild(d)}else i=allokaGetProtocol()+_alloka.server_host+e,r=new XDomainRequest,r.open("POST",i),r.timeout=o,r.onload=function(){n(r.responseText,200,a.oid)},r.onerror=function(){allokaLog("request failed to "+i),"undefined"==typeof t.ga_client_id&&(a.failure=!0,allokaSetValueToBlocksByClass(a.block_class,undefined,a))},r.ontimeout=function(){allokaLog("request timeout to "+i),"undefined"==typeof t.ga_client_id&&(a.failure=!0,allokaSetValueToBlocksByClass(a.block_class,undefined,a))},r.send(Base64.encode(JSON.stringify(t)))}function allokaHandleResponse(e,t,n){try{var o,a,i;if(i=_alloka.objects[n],200==t||422==t)if(allokaIsObject(e))a=e;else{if(!allokaIsString(e)||!allokaJsonAvailable())throw"unable_to_parse_response";a=JSON.parse(e)}else if(200!=t)return void allokaSetValueToBlocksByClass(i.block_class,undefined,i);if(a.data===undefined||"object"!=typeof a.data||"object"==typeof a.errors){"string"==typeof a.errors&&(a.errors=[[a.errors]]);for(var r in a.errors)allokaLog(a.errors[r].join(", "),i)}if("object"==typeof a.data&&allokaIsString(a.data.number)&&a.data.number.length>=6&&"object"!=typeof a.errors){if(i.success=!0,i.is_fixed_number="undefined"!=typeof a.data.is_fixed_number,"undefined"!=typeof a.data.faye_enabled&&!0===a.data.faye_enabled&&(i.faye_enabled=!0),"undefined"!=typeof a.data.feedback_popup_enabled&&!0===a.data.feedback_popup_enabled&&(i.feedback_popup_enabled=!0),"undefined"!=typeof a.data.feedback_js_enabled&&!0===a.data.feedback_js_enabled&&(i.feedback_js_enabled=!0),"undefined"!=typeof a.data.need_client_actions&&!0===a.data.need_client_actions&&(i.need_client_actions=!0),"undefined"!=typeof a.data.metrika_enabled&&!0===a.data.metrika_enabled&&(i.metrika_enabled=!0),"undefined"!=typeof a.data.vk_enabled&&!0===a.data.vk_enabled&&(i.vk_enabled=!0),(i.faye_enabled||i.feedback_popup_enabled||i.feedback_js_enabled||i.metrika_enabled||i.vk_enabled)&&setTimeout(function(){allokaSubscribe(i)},2e3),allokaDebug("done "+i.oid),allokaExecute(i.oid),o=a.data.number.substr(1),i.cached_number!==undefined&&o==i.cached_number)return;allokaSetCookie(_alloka.cookie_prefix+"number_"+i.oid,o)}else o=undefined,i.success=!1;allokaSetValueToBlocksByClass(i.block_class,o,i)}catch(e){allokaLog(e)}}function allokaSetValueToBlocksByClass(class_name,value,obj){var blocks=allokaGetElementsByClassName(class_name);if("object"==typeof class_name){for(var i=0;i<class_name.length;i++)blocks=blocks.concat(Array.prototype.slice.call(document.getElementsByClassName(class_name[i])));blocks=allokaArrayUnique(blocks)}else blocks=document.getElementsByClassName(class_name);for(var i=0;i<blocks.length;i++)if(""===value)blocks[i].setAttribute("data-phone",escape(blocks[i].innerHTML));else if(value===undefined)blocks[i].getAttribute("data-phone")!=undefined&&allokaGetCookie(_alloka.cookie_prefix+"number_"+obj.oid)&&allokaSetCookie(_alloka.cookie_prefix+"number_"+obj.oid,"",-1);else{var formatted_number;if(formatted_number=window.allokaFormatPhoneHook?window.allokaFormatPhoneHook(blocks[i],value):blocks[i].getAttribute("data-alloka-format")!=undefined?eval("("+blocks[i].getAttribute("data-alloka-format")+")")(blocks[i],value):allokaFormatPhone(value,obj.format),"A"==blocks[i].parentNode.tagName)blocks[i].parentNode.setAttribute("href","tel:+"+allokaFormatPhone(value,obj.number_format||"7#{XXX}#{XXX}#{XX}#{XX}")),blocks[i].innerHTML=formatted_number;else if(_alloka.is_mobile||"A"==blocks[i].tagName){for(var attributes="",j=0;j<blocks[i].attributes.length;j++)"href"!=blocks[i].attributes[j].name&&(attributes+=blocks[i].attributes[j].name+'="'+blocks[i].attributes[j].value+'" ');blocks[i].outerHTML="<a "+attributes.trim()+' href="tel:+'+allokaFormatPhone(value,obj.number_format||"7#{XXX}#{XXX}#{XX}#{XX}")+'" style="cursor: default; text-decoration: none;">'+formatted_number+"</a>"}else blocks[i].innerHTML=formatted_number}}function allokaGenerateSessionId(){var e=function(){return(65536*(1+Math.random())|0).toString(16).substring(1)};return e()+e()+e()+e()+e()+e()+e()+e()}function allokaFormatPhone(e,t){var n="",o=t.match(/#{(X)+}/gi),a=t;if(o){for(var i=0;i<o.length;i++)a=a.replace(/#{(X)+}/i,"$$"+(i+1)),n+="("+o[i].slice(2,-1).replace(/(X)/gi,"\\d")+")";return n=new RegExp(n),e.replace(n,a)}return a}function allokaBindReady(e){function t(){if(o)return o=!0;e()}function n(){if(o)return!1;try{document.documentElement.doScroll("left"),t()}catch(e){setTimeout(n,10)}}var o=!1;if(document.addEventListener)document.addEventListener("DOMContentLoaded",t,!1);else if(document.attachEvent){try{var a=null!=window.frameElement}catch(e){}document.documentElement.doScroll&&!a&&n(),document.attachEvent("onreadystatechange",function(){"complete"===document.readyState&&t()})}else if(window.addEventListener)window.addEventListener("load",t,!1);else if(window.attachEvent)window.attachEvent("onload",t);else{var i=window.onload;window.onload=function(){i&&i(),t()}}}function allokaGetElementsByClassName(e){var t=[];if("object"==typeof e){for(var n=0;n<e.length;n++)t=t.concat(Array.prototype.slice.call(document.getElementsByClassName(e[n])));t=allokaArrayUnique(t)}else t=document.getElementsByClassName(e);return t}function allokaAddAllokaClassToText(e,t){function n(e){return e.replace(/[\-\[\]\/\{\}\(\)\*\+\?\.\\\^\$\|]/g,"\\$&")}function o(o){for(var a,i,r=[],s=new RegExp(n(e),"gi");a=s.exec(o.data);)r.push(a);for(var l=r.length;l-- >0;)a=r[l],o.splitText(a.index),o.nextSibling.splitText(a[0].length),i=document.createElement("span"),i.className=t,i.appendChild(document.createTextNode(a[0])),o.parentNode.replaceChild(i,o.nextSibling)}function a(e){for(var n=e.childNodes.length;n-- >0;){var i=e.childNodes[n];if(!i.classList||!i.classList.contains(t))if(1==i.nodeType){var r=i.nodeName.toLowerCase();"style"!=r&&"script"!=r&&a(i)}else 3==i.nodeType&&o(i)}}t||(t="phone_alloka"),a(document.body)}function allokaGetYandexClientId(){try{var e,t;if(window.Ya&&window.Ya.Metrika2&&window.Ya.Metrika2.counters&&window.Ya.Metrika2.counters().length&&(e=window.Ya.Metrika2.counters()),window.Ya&&window.Ya.Metrika&&window.Ya.Metrika.counters&&window.Ya.Metrika.counters().length&&(e=window.Ya.Metrika.counters()),e.length)for(var n=0;!t&&n<e.length;)window["yaCounter"+e[n].id]&&(t=window["yaCounter"+e[n].id]),n++;if(t)return t.getClientID();if(allokaGetCookie("_ym_uid")&&allokaGetCookie("_ym_uid").length)return allokaGetCookie("_ym_uid")}catch(e){allokaDebug("get yandex client id error:",e)}}function allokaGetGaClientId(){var e,t=allokaGetCookie("_ga"),n=allokaGetCookie("__utma");return window.ga&&window.ga.getAll?window.ga.getAll()[0].get("clientId"):t&&t.length>0?(e=t.split(".").slice(2,4).join("."),e.length>0?e:null):n&&n.length>0?(e=n.split(".").slice(1,3).join("."),e.length>0?e:null):null}function allokaIsMobile(){return null!=navigator.userAgent.match(/Android|BlackBerry|iPhone|iPad|iPod|Opera Mini|Symbian|Nokia|IEMobile|MeeGo|Maemo/i)}function allokaReferrerIsValid(e){var t=e.split("://");return t.shift(),e&&e.length>0&&0!=t[0].toString().indexOf(document.location.host)}function allokaLog(e,t){if(void 0!==e){var n;n="undefined"!=typeof e.stack&&e.stack.length>0?[e.message].concat(e.stack):"undefined"!=typeof e.message&&e.message.length>0?e.message:e,-1==["invalid_oid","order_not_found","inactive_order","inactive_object","ip_address_blocked","unable_to_retrieve_a_number","geo_not_match"].indexOf(n)&&allokaRemoteErrorLog(n,t),n="Alloka error: "+n,"undefined"!=typeof console?console.log(n):"undefined"!=typeof window.console&&window.console.log(n)}}function allokaIsDebug(){return"undefined"!=typeof _alloka&&_alloka.debug}function allokaDebug(e){allokaIsDebug()&&console.log((new Date).toISOString()+" -- "+e)}function allokaRemoteErrorLog(e,t){var n=allokaGetProtocol()+_alloka.server_host+"/api/site/error_log";n+="?msg="+e,"object"==typeof t&&(n+="&oid="+t.oid,n+="&session_id="+t.session_id),n+="&location="+Base64.encode(document.location.toString()),document.createElement("img").src=n}function allokaDetectCORS(){return"undefined"!=typeof XMLHttpRequest&&"withCredentials"in new XMLHttpRequest?1:window.XDomainRequest?2:0}function allokaOnLoad(e){"complete"==document.readyState?e():allokaAddEvent(window,"load",e)}function allokaAddEvent(e,t,n){e.addEventListener?e.addEventListener(t,n,!1):e.attachEvent&&e.attachEvent("on"+t,n)}function allokaRemoveEvent(e,t,n){e.removeEventListener?e.removeEventListener(t,n,!1):e.detachEvent&&e.detachEvent("on"+t,n)}function allokaIsArray(e){return void 0!==e&&"[object Array]"===Object.prototype.toString.call(e)}function allokaIsObject(e){return void 0!==e&&"[object Object]"===Object.prototype.toString.call(e)}function allokaIsString(e){return void 0!==e&&"[object String]"===Object.prototype.toString.call(e)}function allokaArrayUnique(e){if(allokaIsArray(e)){for(var t=e.concat(),n=0;n<t.length;++n)for(var o=n+1;o<t.length;++o)t[n]===t[o]&&t.splice(o--,1);return t}return!1}function allokaGetObjectSize(e){if(allokaIsObject(e)||allokaIsArray(e)){var t=0;for(key in e)e.hasOwnProperty(key)&&t++;return t}return NaN}function allokaGetObjectKeys(e){if(allokaIsObject(e)){var t=[];for(var n in e)t.push(n);return t}return undefined}function allokaJsonAvailable(){return"object"==typeof JSON&&"function"==typeof JSON.stringify&&"function"==typeof JSON.parse}function set_jivosite_data(){var e="",t="";try{if(e=allokaGetCookie("allokaid")||"",_alloka.objects)for(var n in _alloka.objects)one=_alloka.objects[n],one.jivosite&&one.session_id&&(t=one.session_id);jivo_api.setUserToken(e+"|"+t)}catch(e){}}function build_one_email(e,t,n,o){var a=allokaGetCookie("alloka_email_"+t);if(a)allokaMakeEmail(_alloka.objects[t],t,a,o);else{var i={alloka_id:n,oid:t,version:o,session_id:_alloka.objects[t].session_id},r=allokaGetReferrer();r&&r.length&&(i.referrer=r.slice(0,150)),i.location=decodeURI(document.location.toString()),allokaMakeRequest("/api/site/email",i,allokaHandleEmailTracking)}}function allokaHandleEmailTracking(e,t,n){try{var o;200==t&&(o=JSON.parse(e),allokaMakeEmail(_alloka.objects[n],n,o.track,o.version),allokaSetCookie("alloka_email_"+n,o.track,2))}catch(e){allokaLog(e)}}function allokaMakeEmail(e,t,n){for(var o=e.email.alias,a=e.email.domain,i=e.email.email_class||"email",r=e.email.raw||!1,s=o+"."+n+"@"+a,l=/\s*,\s*/,c=i.split(l),d=0;d<c.length;d++)for(var u=document.getElementsByClassName(c[d]),f=0;f<u.length;f++)u[f].setAttribute("href","mailto:"+s),r&&(u[f].innerHTML=s)}function build_email_tracking_form(e){var t=allokaGetCookie(allokaAllokaIdCookieName);if(t)try{_alloka.objects[e].email&&build_one_email(_alloka.objects[e],e,t,2)}catch(e){console.log("email tracking error:",e)}}function allokaShowRatingModal(e){function t(){l.querySelector(".calldroneWindow__closeButton").addEventListener("click",t),l.querySelector(".calldroneWindow__button_good").removeEventListener("click",n),l.querySelector(".calldroneWindow__button_bad").removeEventListener("click",o),allokaCloseRatingModal()}function n(){allokaSaveCallRating(Object.assign(e,{call:{caller_rating:1}}))}function o(){allokaSaveCallRating(Object.assign(e,{call:{caller_rating:0}}))}
var a,i=translations[e.lang],r='<div class="calldroneWindow">      <div class="calldroneWindow__content">          <div class="calldroneWindow__closeButton"></div>          <h3 class="calldroneWindow__title">'+i.title+'</h3>          <div class="calldroneWindow__actions">            <div class="calldroneWindow__button calldroneWindow__button_good">              <svg xmlns="http://www.w3.org/2000/svg" width="63" height="57" viewBox="0 0 63 57"><path d="M.014 57h11.449V22.8H.014V57zm62.972-31.35a5.729 5.729 0 0 0-5.725-5.7H39.228l2.863-13.11v-.855a5.961 5.961 0 0 0-1.145-3.135L37.8 0 18.906 18.81a4.773 4.773 0 0 0-1.717 3.99v28.5a5.729 5.729 0 0 0 5.724 5.7h25.761a5.655 5.655 0 0 0 5.152-3.42l8.587-20.235a4.831 4.831 0 0 0 .286-2v-5.7h.286z" fill="currentColor" fill-rule="evenodd"/></svg>            </div>            <div class="calldroneWindow__button calldroneWindow__button_bad">              <svg xmlns="http://www.w3.org/2000/svg" width="63" height="57" viewBox="0 0 63 57"><path d="M.014 0h11.45v34.2H.014V0zm62.972 31.35a5.729 5.729 0 0 1-5.725 5.7H39.228l2.862 13.11v.855a5.96 5.96 0 0 1-1.145 3.135L37.8 57 18.906 38.19a4.773 4.773 0 0 1-1.718-3.99V5.7A5.729 5.729 0 0 1 22.913 0h25.761a5.655 5.655 0 0 1 5.152 3.42l8.587 20.235a4.831 4.831 0 0 1 .287 1.995v5.7h.286z" fill="currentColor" fill-rule="evenodd"/></svg>            </div>          </div>      </div>    </div>',s="<style>body,html{margin:0;padding:0;border:0;vertical-align:baseline;-webkit-tap-highlight-color:rgba(0,0,0,0)}a,abbr,acronym,address,applet,article,aside,audio,big,blockquote,canvas,caption,center,cite,code,dd,del,details,dfn,div,dl,dt,embed,fieldset,figcaption,figure,footer,form,h1,h2,h3,h4,h5,h6,header,hgroup,iframe,img,ins,kbd,label,legend,li,mark,menu,nav,object,ol,output,p,pre,q,ruby,s,samp,section,small,span,strike,sub,summary,sup,table,tbody,td,tfoot,th,thead,time,tr,tt,ul,var,video{margin:0;padding:0;border:0;font:inherit;vertical-align:baseline;-webkit-tap-highlight-color:rgba(0,0,0,0)}article,aside,details,figcaption,figure,footer,header,hgroup,menu,nav,section{display:block}body{line-height:1}ol,ul{list-style:none}blockquote,q{quotes:none}blockquote:after,blockquote:before,q:after,q:before{content:none}table{border-collapse:collapse;border-spacing:0}td,th{text-align:left}textarea{resize:none}address{font-style:normal}button,input,select,textarea{outline:none;font:inherit;-webkit-font-smoothing:inherit;-webkit-appearance:none}*,:after,:before{box-sizing:border-box}body,html{height:100%;color:#000;font:15px/1.3 Arial,Helvetica,sans-serif;-webkit-text-size-adjust:100%;-moz-osx-font-smoothing:grayscale}.calldroneWindow{position:fixed;top:0;left:0;width:100%;height:100%;background-color:rgba(0,0,0,.45)}.calldroneWindow__content{position:absolute;display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-box-orient:vertical;-webkit-box-direction:normal;-webkit-flex-direction:column;-ms-flex-direction:column;flex-direction:column;-webkit-justify-content:space-around;-ms-flex-pack:distribute;justify-content:space-around;width:456px;height:456px;top:50%;left:50%;margin-left:-228px;margin-top:-228px;padding:95px 50px;background-color:#fff;border-radius:228px}.calldroneWindow__closeButton{position:absolute;width:50px;height:50px;top:30px;left:-webkit-calc(50% - 50px/2);left:calc(50% - 50px/2);padding:5px;cursor:pointer;-webkit-transition:opacity .28s;transition:opacity .28s}.calldroneWindow__button:hover,.calldroneWindow__closeButton:hover{opacity:.75}.calldroneWindow__closeButton:after,.calldroneWindow__closeButton:before{position:absolute;display:block;width:40px;height:2px;top:-webkit-calc(50% - 2px/2);top:calc(50% - 2px/2);left:-webkit-calc(50% - 40px/2);left:calc(50% - 40px/2);background-color:#52bd00;-webkit-transform-origin:50%;-ms-transform-origin:50%;transform-origin:50%;content:''}.calldroneWindow__closeButton:before{-webkit-transform:rotate(45deg);-ms-transform:rotate(45deg);transform:rotate(45deg)}.calldroneWindow__closeButton:after{-webkit-transform:rotate(-45deg);-ms-transform:rotate(-45deg);transform:rotate(-45deg)}.calldroneWindow__title{margin-bottom:25px;line-height:1.12;font-size:33px;font-weight:700;text-align:center;color:#000}.calldroneWindow__actions,.calldroneWindow__button{display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-box-pack:center;-webkit-justify-content:center;-ms-flex-pack:center;justify-content:center}.calldroneWindow__button{width:156px;height:156px;top:50%;left:50%;-webkit-box-align:center;-webkit-align-items:center;-ms-flex-align:center;align-items:center;margin-right:16px;border-radius:78px;text-align:center;color:#fff;cursor:pointer;-webkit-transition:opacity .28s;transition:opacity .28s}.calldroneWindow__button_good{background-color:#52bd00}.calldroneWindow__button_good svg{margin-top:-4px}.calldroneWindow__button_bad{background-color:#e16668}.calldroneWindow__button_bad svg{margin-top:12px}.calldroneWindow__button:last-child{margin-right:0}</style>";a=document.createElement("iframe"),a.src="data:text/html;charset=utf-8,"+encodeURI(r),a.setAttribute("id","alloka_rating_modal"),a.setAttribute("name","alloka_rating_modal"),a.setAttribute("allowTransparency",!0),a.style.width=window.innerWidth+"px",a.style.height=window.innerHeight+"px",a.style.position="fixed",a.style.top="0",a.style.left="0",a.style.zIndex="99999999",a.style.border="none",a.style.background="none",document.body.appendChild(a);var l=a.contentWindow.document;l.open(),l.write(s+r),l.close(),l.querySelector(".calldroneWindow__button_good").addEventListener("click",n),l.querySelector(".calldroneWindow__button_bad").addEventListener("click",o),l.querySelector(".calldroneWindow__closeButton").addEventListener("click",t)}function allokaCloseRatingModal(){document.getElementById("alloka_rating_modal").remove()}function allokaSaveCallRating(e){return allokaMakeRequest("/api/site/rating",e,allokaCloseRatingModal),!1}!function(){!function(){"use strict";var Faye={VERSION:"1.1.2",BAYEUX_VERSION:"1.0",ID_LENGTH:160,JSONP_CALLBACK:"jsonpcallback",CONNECTION_TYPES:["long-polling","cross-origin-long-polling","callback-polling","websocket","eventsource","in-process"],MANDATORY_CONNECTION_TYPES:["long-polling","callback-polling","in-process"],ENV:"undefined"!=typeof window?window:global,extend:function(e,t,n){if(!t)return e;for(var o in t)t.hasOwnProperty(o)&&(e.hasOwnProperty(o)&&!1===n||e[o]!==t[o]&&(e[o]=t[o]));return e},random:function(e){e=e||this.ID_LENGTH;for(var t=Math.ceil(e*Math.log(2)/Math.log(36)),n=csprng(e,36);n.length<t;)n="0"+n;return n},validateOptions:function(e,t){for(var n in e)if(this.indexOf(t,n)<0)throw Error("Unrecognized option: "+n)},clientIdFromMessages:function(e){var t=this.filter([].concat(e),function(e){return"/meta/connect"===e.channel});return t[0]&&t[0].clientId},copyObject:function(e){var t,n,o;if(e instanceof Array){for(t=[],n=e.length;n--;)t[n]=Faye.copyObject(e[n]);return t}if("object"==typeof e){t=null===e?null:{};for(o in e)t[o]=Faye.copyObject(e[o]);return t}return e},commonElement:function(e,t){for(var n=0,o=e.length;o>n;n++)if(-1!==this.indexOf(t,e[n]))return e[n];return null},indexOf:function(e,t){if(e.indexOf)return e.indexOf(t);for(var n=0,o=e.length;o>n;n++)if(e[n]===t)return n;return-1},map:function(e,t,n){if(e.map)return e.map(t,n);var o=[];if(e instanceof Array)for(var a=0,i=e.length;i>a;a++)o.push(t.call(n||null,e[a],a));else for(var r in e)e.hasOwnProperty(r)&&o.push(t.call(n||null,r,e[r]));return o},filter:function(e,t,n){if(e.filter)return e.filter(t,n);for(var o=[],a=0,i=e.length;i>a;a++)t.call(n||null,e[a],a)&&o.push(e[a]);return o},asyncEach:function(e,t,n,o){var a=e.length,i=-1,r=0,s=!1,l=function(){return r-=1,i+=1,i===a?n&&n.call(o):void t(e[i],d)},c=function(){if(!s){for(s=!0;r>0;)l();s=!1}},d=function(){r+=1,c()};d()},toJSON:function(e){return this.stringify?this.stringify(e,function(e,t){return this[e]instanceof Array?this[e]:t}):JSON.stringify(e)}};"undefined"!=typeof module?module.exports=Faye:"undefined"!=typeof window&&(window.Faye=Faye),Faye.Class=function(e,t){"function"!=typeof e&&(t=e,e=Object);var n=function(){return this.initialize?this.initialize.apply(this,arguments)||this:this},o=function(){};return o.prototype=e.prototype,n.prototype=new o,Faye.extend(n.prototype,t),n},function(){function e(e,t){if(e.indexOf)return e.indexOf(t);for(var n=0;n<e.length;n++)if(t===e[n])return n;return-1}var t=Faye.EventEmitter=function(){},n="function"==typeof Array.isArray?Array.isArray:function(e){return"[object Array]"===Object.prototype.toString.call(e)};t.prototype.emit=function(e){if("error"===e&&(!this._events||!this._events.error||n(this._events.error)&&!this._events.error.length))throw arguments[1]instanceof Error?arguments[1]:Error("Uncaught, unspecified 'error' event.");if(!this._events)return!1;var t=this._events[e];if(!t)return!1;if("function"==typeof t){switch(arguments.length){case 1:t.call(this);break;case 2:t.call(this,arguments[1]);break;case 3:t.call(this,arguments[1],arguments[2]);break;default:var o=Array.prototype.slice.call(arguments,1);t.apply(this,o)}return!0}if(n(t)){for(var o=Array.prototype.slice.call(arguments,1),a=t.slice(),i=0,r=a.length;r>i;i++)a[i].apply(this,o);return!0}return!1},t.prototype.addListener=function(e,t){if("function"!=typeof t)throw Error("addListener only takes instances of Function");return this._events||(this._events={}),this.emit("newListener",e,t),this._events[e]?n(this._events[e])?this._events[e].push(t):this._events[e]=[this._events[e],t]:this._events[e]=t,this},t.prototype.on=t.prototype.addListener,t.prototype.once=function(e,t){var n=this;return n.on(e,function o(){n.removeListener(e,o),t.apply(this,arguments)}),this},t.prototype.removeListener=function(t,o){if("function"!=typeof o)throw Error("removeListener only takes instances of Function");if(!this._events||!this._events[t])return this;var a=this._events[t];if(n(a)){var i=e(a,o);if(0>i)return this;a.splice(i,1),0==a.length&&delete this._events[t]}else this._events[t]===o&&delete this._events[t];return this},t.prototype.removeAllListeners=function(e){return 0===arguments.length?(this._events={},this):(e&&this._events&&this._events[e]&&(this._events[e]=null),this)},t.prototype.listeners=function(e){return this._events||(this._events={}),this._events[e]||(this._events[e]=[]),n(this._events[e])||(this._events[e]=[this._events[e]]),this._events[e]}}(),Faye.Namespace=Faye.Class({initialize:function(){this._used={}},exists:function(e){return this._used.hasOwnProperty(e)},generate:function(){for(var e=Faye.random();this._used.hasOwnProperty(e);)e=Faye.random();return this._used[e]=e},release:function(e){delete this._used[e]}}),function(){var e,t=setTimeout;e="function"==typeof setImmediate?function(e){setImmediate(e)}:"object"==typeof process&&process.nextTick?function(e){process.nextTick(e)}:function(e){t(e,0)};var n=0,o=1,a=2,i=function(e){return e},r=function(e){throw e},s=function(e){if(this._state=n,this._onFulfilled=[],this._onRejected=[],"function"==typeof e){var t=this;e(function(e){f(t,e)},function(e){p(t,e)})}};s.prototype.then=function(e,t){var n=new s;return l(this,e,n),c(this,t,n),n};var l=function(e,t,a){"function"!=typeof t&&(t=i);var r=function(e){d(t,e,a)};e._state===n?e._onFulfilled.push(r):e._state===o&&r(e._value)},c=function(e,t,o){"function"!=typeof t&&(t=r);var i=function(e){d(t,e,o)};e._state===n?e._onRejected.push(i):e._state===a&&i(e._reason)},d=function(t,n,o){e(function(){u(t,n,o)})},u=function(e,t,n){var o;try{o=e(t)}catch(e){return p(n,e)}o===n?p(n,new TypeError("Recursive promise chain detected")):f(n,o)},f=s.fulfill=s.resolve=function(e,t){var n,o,a=!1;try{if(n=typeof t,"function"!=typeof(o=null!==t&&("function"===n||"object"===n)&&t.then))return h(e,t);o.call(t,function(t){a^(a=!0)&&f(e,t)},function(t){a^(a=!0)&&p(e,t)})}catch(t){if(!(a^(a=!0)))return;p(e,t)}},h=function(e,t){if(e._state===n){e._state=o,e._value=t,e._onRejected=[];for(var a,i=e._onFulfilled;a=i.shift();)a(t)}},p=s.reject=function(e,t){if(e._state===n){e._state=a,e._reason=t,e._onFulfilled=[];for(var o,i=e._onRejected;o=i.shift();)o(t)}};s.all=function(e){return new s(function(t,n){var o,a=[],i=e.length;if(0===i)return t(a);for(o=0;i>o;o++)!function(e,o){s.fulfilled(e).then(function(e){a[o]=e,0==--i&&t(a)},n)}(e[o],o)})},s.defer=e,s.deferred=s.pending=function(){var e={};return e.promise=new s(function(t,n){e.fulfill=e.resolve=t,e.reject=n}),e},s.fulfilled=s.resolved=function(e){return new s(function(t){t(e)})},s.rejected=function(e){return new s(function(t,n){n(e)})},void 0===Faye?module.exports=s:Faye.Promise=s}(),Faye.Set=Faye.Class({initialize:function(){this._index={}},add:function(e){var t=void 0!==e.id?e.id:e;return!this._index.hasOwnProperty(t)&&(this._index[t]=e,!0)},forEach:function(e,t){for(var n in this._index)this._index.hasOwnProperty(n)&&e.call(t,this._index[n])},isEmpty:function(){for(var e in this._index)if(this._index.hasOwnProperty(e))return!1;return!0},member:function(e){for(var t in this._index)if(this._index[t]===e)return!0;return!1},remove:function(e){var t=void 0!==e.id?e.id:e,n=this._index[t];return delete this._index[t],n},toArray:function(){var e=[];return this.forEach(function(t){e.push(t)}),e}}),Faye.URI={isURI:function(e){return e&&e.protocol&&e.host&&e.path},isSameOrigin:function(e){var t=Faye.ENV.location;return e.protocol===t.protocol&&e.hostname===t.hostname&&e.port===t.port},parse:function(e){if("string"!=typeof e)return e;var t,n,o,a,i,r,s={},l=function(t,n){e=e.replace(n,function(e){return s[t]=e,""}),s[t]=s[t]||""};for(l("protocol",/^[a-z]+\:/i),l("host",/^\/\/[^\/\?#]+/),/^\//.test(e)||s.host||(e=Faye.ENV.location.pathname.replace(/[^\/]*$/,"")+e),l("pathname",/^[^\?#]*/),l("search",/^\?[^#]*/),l("hash",/^#.*/),s.protocol=s.protocol||Faye.ENV.location.protocol,s.host?(s.host=s.host.substr(2),t=s.host.split(":"),s.hostname=t[0],s.port=t[1]||""):(s.host=Faye.ENV.location.host,s.hostname=Faye.ENV.location.hostname,s.port=Faye.ENV.location.port),s.pathname=s.pathname||"/",s.path=s.pathname+s.search,n=s.search.replace(/^\?/,""),o=n?n.split("&"):[],r={},a=0,i=o.length;i>a;a++)t=o[a].split("="),r[decodeURIComponent(t[0]||"")]=decodeURIComponent(t[1]||"");return s.query=r,s.href=this.stringify(s),s},stringify:function(e){var t=e.protocol+"//"+e.hostname;return e.port&&(t+=":"+e.port),t+=e.pathname+this.queryString(e.query)+(e.hash||"")},queryString:function(e){var t=[];for(var n in e)e.hasOwnProperty(n)&&t.push(encodeURIComponent(n)+"="+encodeURIComponent(e[n]));return 0===t.length?"":"?"+t.join("&")}},Faye.Error=Faye.Class({initialize:function(e,t,n){this.code=e,this.params=Array.prototype.slice.call(t),this.message=n},toString:function(){return this.code+":"+this.params.join(",")+":"+this.message}}),Faye.Error.parse=function(e){if(e=e||"",!Faye.Grammar.ERROR.test(e))return new this(null,[],e);var t=e.split(":"),n=parseInt(t[0]),o=t[1].split(","),e=t[2];return new this(n,o,e)},Faye.Error.versionMismatch=function(){return""+new this(300,arguments,"Version mismatch")},Faye.Error.conntypeMismatch=function(){return""+new this(301,arguments,"Connection types not supported")},Faye.Error.extMismatch=function(){return""+new this(302,arguments,"Extension mismatch")},Faye.Error.badRequest=function(){return""+new this(400,arguments,"Bad request")},Faye.Error.clientUnknown=function(){return""+new this(401,arguments,"Unknown client")},Faye.Error.parameterMissing=function(){return""+new this(402,arguments,"Missing required parameter")},Faye.Error.channelForbidden=function(){return""+new this(403,arguments,"Forbidden channel")},Faye.Error.channelUnknown=function(){return""+new this(404,arguments,"Unknown channel")},Faye.Error.channelInvalid=function(){return""+new this(405,arguments,"Invalid channel")},Faye.Error.extUnknown=function(){return""+new this(406,arguments,"Unknown extension")},Faye.Error.publishFailed=function(){return""+new this(407,arguments,"Failed to publish")},Faye.Error.serverError=function(){return""+new this(500,arguments,"Internal server error")},Faye.Deferrable={then:function(e,t){var n=this;return this._promise||(this._promise=new Faye.Promise(function(e,t){n._fulfill=e,n._reject=t})),0===arguments.length?this._promise:this._promise.then(e,t)},callback:function(e,t){return this.then(function(n){e.call(t,n)})},errback:function(e,t){return this.then(null,function(n){e.call(t,n)})},timeout:function(e,t){this.then();var n=this;this._timer=Faye.ENV.setTimeout(function(){n._reject(t)},1e3*e)},setDeferredStatus:function(e,t){this._timer&&Faye.ENV.clearTimeout(this._timer),this.then(),"succeeded"===e?this._fulfill(t):"failed"===e?this._reject(t):delete this._promise}},Faye.Publisher={countListeners:function(e){return this.listeners(e).length},bind:function(e,t,n){var o=Array.prototype.slice,a=function(){t.apply(n,o.call(arguments))};return this._listeners=this._listeners||[],this._listeners.push([e,t,n,a]),this.on(e,a)},unbind:function(e,t,n){this._listeners=this._listeners||[];for(var o,a=this._listeners.length;a--;)o=this._listeners[a],o[0]===e&&(!t||o[1]===t&&o[2]===n)&&(this._listeners.splice(a,1),this.removeListener(e,o[3]))}},Faye.extend(Faye.Publisher,Faye.EventEmitter.prototype),Faye.Publisher.trigger=Faye.Publisher.emit,Faye.Timeouts={addTimeout:function(e,t,n,o){if(this._timeouts=this._timeouts||{},!this._timeouts.hasOwnProperty(e)){var a=this;this._timeouts[e]=Faye.ENV.setTimeout(function(){delete a._timeouts[e],n.call(o)},1e3*t)}},removeTimeout:function(e){this._timeouts=this._timeouts||{};var t=this._timeouts[e];t&&(Faye.ENV.clearTimeout(t),delete this._timeouts[e])},removeAllTimeouts:function(){this._timeouts=this._timeouts||{};for(var e in this._timeouts)this.removeTimeout(e)}},Faye.Logging={LOG_LEVELS:{fatal:4,error:3,warn:2,info:1,debug:0},writeLog:function(e,t){if(Faye.logger){var n=Array.prototype.slice.apply(e),o="[Faye",a=this.className,i=n.shift().replace(/\?/g,function(){try{return Faye.toJSON(n.shift())}catch(e){return"[Object]"}});for(var r in Faye)a||"function"==typeof Faye[r]&&this instanceof Faye[r]&&(a=r);a&&(o+="."+a),o+="] ","function"==typeof Faye.logger[t]?Faye.logger[t](o+i):"function"==typeof Faye.logger&&Faye.logger(o+i)}}},function(){for(var e in Faye.Logging.LOG_LEVELS)!function(e){Faye.Logging[e]=function(){this.writeLog(arguments,e)}}(e)}(),Faye.Grammar={CHANNEL_NAME:/^\/(((([a-z]|[A-Z])|[0-9])|(\-|\_|\!|\~|\(|\)|\$|\@)))+(\/(((([a-z]|[A-Z])|[0-9])|(\-|\_|\!|\~|\(|\)|\$|\@)))+)*$/,CHANNEL_PATTERN:/^(\/(((([a-z]|[A-Z])|[0-9])|(\-|\_|\!|\~|\(|\)|\$|\@)))+)*\/\*{1,2}$/,ERROR:/^([0-9][0-9][0-9]:(((([a-z]|[A-Z])|[0-9])|(\-|\_|\!|\~|\(|\)|\$|\@)| |\/|\*|\.))*(,(((([a-z]|[A-Z])|[0-9])|(\-|\_|\!|\~|\(|\)|\$|\@)| |\/|\*|\.))*)*:(((([a-z]|[A-Z])|[0-9])|(\-|\_|\!|\~|\(|\)|\$|\@)| |\/|\*|\.))*|[0-9][0-9][0-9]::(((([a-z]|[A-Z])|[0-9])|(\-|\_|\!|\~|\(|\)|\$|\@)| |\/|\*|\.))*)$/,VERSION:/^([0-9])+(\.(([a-z]|[A-Z])|[0-9])(((([a-z]|[A-Z])|[0-9])|\-|\_))*)*$/},Faye.Extensible={addExtension:function(e){this._extensions=this._extensions||[],this._extensions.push(e),e.added&&e.added(this)},removeExtension:function(e){if(this._extensions)for(var t=this._extensions.length;t--;)this._extensions[t]===e&&(this._extensions.splice(t,1),e.removed&&e.removed(this))},pipeThroughExtensions:function(e,t,n,o,a){if(this.debug("Passing through ? extensions: ?",e,t),!this._extensions)return o.call(a,t);var i=this._extensions.slice(),r=function(t){if(!t)return o.call(a,t);var s=i.shift();if(!s)return o.call(a,t);var l=s[e];return l?void(l.length>=3?s[e](t,n,r):s[e](t,r)):r(t)};r(t)}},Faye.extend(Faye.Extensible,Faye.Logging),Faye.Channel=Faye.Class({initialize:function(e){this.id=this.name=e},push:function(e){this.trigger("message",e)},isUnused:function(){return 0===this.countListeners("message")}}),Faye.extend(Faye.Channel.prototype,Faye.Publisher),Faye.extend(Faye.Channel,{HANDSHAKE:"/meta/handshake",CONNECT:"/meta/connect",SUBSCRIBE:"/meta/subscribe",UNSUBSCRIBE:"/meta/unsubscribe",DISCONNECT:"/meta/disconnect",META:"meta",SERVICE:"service",expand:function(e){var t=this.parse(e),n=["/**",e],o=t.slice();o[o.length-1]="*",n.push(this.unparse(o));for(var a=1,i=t.length;i>a;a++)o=t.slice(0,a),o.push("**"),n.push(this.unparse(o));return n},isValid:function(e){return Faye.Grammar.CHANNEL_NAME.test(e)||Faye.Grammar.CHANNEL_PATTERN.test(e)},parse:function(e){return this.isValid(e)?e.split("/").slice(1):null},unparse:function(e){return"/"+e.join("/")},isMeta:function(e){var t=this.parse(e);return t?t[0]===this.META:null},isService:function(e){var t=this.parse(e);return t?t[0]===this.SERVICE:null},isSubscribable:function(e){return this.isValid(e)?!this.isMeta(e)&&!this.isService(e):null},Set:Faye.Class({initialize:function(){this._channels={}},getKeys:function(){var e=[];for(var t in this._channels)e.push(t);return e},remove:function(e){delete this._channels[e]},hasSubscription:function(e){return this._channels.hasOwnProperty(e)},subscribe:function(e,t,n){for(var o,a=0,i=e.length;i>a;a++){o=e[a];var r=this._channels[o]=this._channels[o]||new Faye.Channel(o);t&&r.bind("message",t,n)}},unsubscribe:function(e,t,n){var o=this._channels[e];return!!o&&(o.unbind("message",t,n),!!o.isUnused()&&(this.remove(e),!0))},distributeMessage:function(e){for(var t=Faye.Channel.expand(e.channel),n=0,o=t.length;o>n;n++){var a=this._channels[t[n]];a&&a.trigger("message",e.data)}}})}),Faye.Publication=Faye.Class(Faye.Deferrable),Faye.Subscription=Faye.Class({initialize:function(e,t,n,o){this._client=e,this._channels=t,this._callback=n,this._context=o,this._cancelled=!1},cancel:function(){this._cancelled||(this._client.unsubscribe(this._channels,this._callback,this._context),this._cancelled=!0)},unsubscribe:function(){this.cancel()}}),Faye.extend(Faye.Subscription.prototype,Faye.Deferrable),Faye.Client=Faye.Class({UNCONNECTED:1,CONNECTING:2,CONNECTED:3,DISCONNECTED:4,HANDSHAKE:"handshake",RETRY:"retry",NONE:"none",CONNECTION_TIMEOUT:60,DEFAULT_ENDPOINT:"/bayeux",INTERVAL:0,initialize:function(e,t){this.info("New client created for ?",e),t=t||{},Faye.validateOptions(t,["interval","timeout","endpoints","proxy","retry","scheduler","websocketExtensions","tls","ca"]),this._endpoint=e||this.DEFAULT_ENDPOINT,this._channels=new Faye.Channel.Set,this._dispatcher=new Faye.Dispatcher(this,this._endpoint,t),this._messageId=0,this._state=this.UNCONNECTED,this._responseCallbacks={},this._advice={reconnect:this.RETRY,interval:1e3*(t.interval||this.INTERVAL),timeout:1e3*(t.timeout||this.CONNECTION_TIMEOUT)},this._dispatcher.timeout=this._advice.timeout/1e3,this._dispatcher.bind("message",this._receiveMessage,this),Faye.Event&&void 0!==Faye.ENV.onbeforeunload&&Faye.Event.on(Faye.ENV,"beforeunload",function(){Faye.indexOf(this._dispatcher._disabled,"autodisconnect")<0&&this.disconnect()},this)},addWebsocketExtension:function(e){return this._dispatcher.addWebsocketExtension(e)},disable:function(e){return this._dispatcher.disable(e)},setHeader:function(e,t){return this._dispatcher.setHeader(e,t)},handshake:function(e,t){if(this._advice.reconnect!==this.NONE&&this._state===this.UNCONNECTED){this._state=this.CONNECTING;var n=this;this.info("Initiating handshake with ?",Faye.URI.stringify(this._endpoint)),this._dispatcher.selectTransport(Faye.MANDATORY_CONNECTION_TYPES),this._sendMessage({channel:Faye.Channel.HANDSHAKE,version:Faye.BAYEUX_VERSION,supportedConnectionTypes:this._dispatcher.getConnectionTypes()},{},function(o){o.successful?(this._state=this.CONNECTED,this._dispatcher.clientId=o.clientId,this._dispatcher.selectTransport(o.supportedConnectionTypes),this.info("Handshake successful: ?",this._dispatcher.clientId),this.subscribe(this._channels.getKeys(),!0),e&&Faye.Promise.defer(function(){e.call(t)})):(this.info("Handshake unsuccessful"),Faye.ENV.setTimeout(function(){n.handshake(e,t)},1e3*this._dispatcher.retry),this._state=this.UNCONNECTED)},this)}},connect:function(e,t){if(this._advice.reconnect!==this.NONE&&this._state!==this.DISCONNECTED){if(this._state===this.UNCONNECTED)return this.handshake(function(){this.connect(e,t)},this);this.callback(e,t),this._state===this.CONNECTED&&(this.info("Calling deferred actions for ?",this._dispatcher.clientId),this.setDeferredStatus("succeeded"),this.setDeferredStatus("unknown"),this._connectRequest||(this._connectRequest=!0,this.info("Initiating connection for ?",this._dispatcher.clientId),this._sendMessage({channel:Faye.Channel.CONNECT,clientId:this._dispatcher.clientId,connectionType:this._dispatcher.connectionType},{},this._cycleConnection,this)))}},disconnect:function(){if(this._state===this.CONNECTED){this._state=this.DISCONNECTED,this.info("Disconnecting ?",this._dispatcher.clientId);var e=new Faye.Publication;return this._sendMessage({channel:Faye.Channel.DISCONNECT,clientId:this._dispatcher.clientId},{},function(t){t.successful?(this._dispatcher.close(),e.setDeferredStatus("succeeded")):e.setDeferredStatus("failed",Faye.Error.parse(t.error))},this),this.info("Clearing channel listeners for ?",this._dispatcher.clientId),this._channels=new Faye.Channel.Set,e}},subscribe:function(e,t,n){if(e instanceof Array)return Faye.map(e,function(e){return this.subscribe(e,t,n)},this);var o=new Faye.Subscription(this,e,t,n),a=!0===t;return this._channels.hasSubscription(e)&&!a?(this._channels.subscribe([e],t,n),o.setDeferredStatus("succeeded"),o):(this.connect(function(){this.info("Client ? attempting to subscribe to ?",this._dispatcher.clientId,e),a||this._channels.subscribe([e],t,n),this._sendMessage({channel:Faye.Channel.SUBSCRIBE,clientId:this._dispatcher.clientId,subscription:e},{},function(a){if(!a.successful)return o.setDeferredStatus("failed",Faye.Error.parse(a.error)),this._channels.unsubscribe(e,t,n);var i=[].concat(a.subscription);this.info("Subscription acknowledged for ? to ?",this._dispatcher.clientId,i),o.setDeferredStatus("succeeded")},this)},this),o)},unsubscribe:function(e,t,n){if(e instanceof Array)return Faye.map(e,function(e){return this.unsubscribe(e,t,n)},this);this._channels.unsubscribe(e,t,n)&&this.connect(function(){this.info("Client ? attempting to unsubscribe from ?",this._dispatcher.clientId,e),this._sendMessage({channel:Faye.Channel.UNSUBSCRIBE,clientId:this._dispatcher.clientId,subscription:e},{},function(e){if(e.successful){var t=[].concat(e.subscription);this.info("Unsubscription acknowledged for ? from ?",this._dispatcher.clientId,t)}},this)},this)},publish:function(e,t,n){Faye.validateOptions(n||{},["attempts","deadline"]);var o=new Faye.Publication;return this.connect(function(){this.info("Client ? queueing published message to ?: ?",this._dispatcher.clientId,e,t),this._sendMessage({channel:e,data:t,clientId:this._dispatcher.clientId},n,function(e){e.successful?o.setDeferredStatus("succeeded"):o.setDeferredStatus("failed",Faye.Error.parse(e.error))},this)},this),o},_sendMessage:function(e,t,n,o){e.id=this._generateMessageId();var a=this._advice.timeout?1.2*this._advice.timeout/1e3:1.2*this._dispatcher.retry;this.pipeThroughExtensions("outgoing",e,null,function(e){e&&(n&&(this._responseCallbacks[e.id]=[n,o]),this._dispatcher.sendMessage(e,a,t||{}))},this)},_generateMessageId:function(){return this._messageId+=1,this._messageId>=Math.pow(2,32)&&(this._messageId=0),this._messageId.toString(36)},_receiveMessage:function(e){var t,n=e.id;void 0!==e.successful&&(t=this._responseCallbacks[n],delete this._responseCallbacks[n]),this.pipeThroughExtensions("incoming",e,null,function(e){e&&(e.advice&&this._handleAdvice(e.advice),this._deliverMessage(e),t&&t[0].call(t[1],e))},this)},_handleAdvice:function(e){Faye.extend(this._advice,e),this._dispatcher.timeout=this._advice.timeout/1e3,this._advice.reconnect===this.HANDSHAKE&&this._state!==this.DISCONNECTED&&(this._state=this.UNCONNECTED,this._dispatcher.clientId=null,this._cycleConnection())},_deliverMessage:function(e){e.channel&&void 0!==e.data&&(this.info("Client ? calling listeners for ? with ?",this._dispatcher.clientId,e.channel,e.data),this._channels.distributeMessage(e))},_cycleConnection:function(){this._connectRequest&&(this._connectRequest=null,this.info("Closed connection for ?",this._dispatcher.clientId));var e=this;Faye.ENV.setTimeout(function(){e.connect()},this._advice.interval)}}),Faye.extend(Faye.Client.prototype,Faye.Deferrable),Faye.extend(Faye.Client.prototype,Faye.Publisher),Faye.extend(Faye.Client.prototype,Faye.Logging),Faye.extend(Faye.Client.prototype,Faye.Extensible),Faye.Dispatcher=Faye.Class({MAX_REQUEST_SIZE:2048,DEFAULT_RETRY:5,UP:1,DOWN:2,initialize:function(e,t,n){this._client=e,this.endpoint=Faye.URI.parse(t),this._alternates=n.endpoints||{},this.cookies=Faye.Cookies&&new Faye.Cookies.CookieJar,this._disabled=[],this._envelopes={},this.headers={},this.retry=n.retry||this.DEFAULT_RETRY,this._scheduler=n.scheduler||Faye.Scheduler,this._state=0,this.transports={},this.wsExtensions=[],this.proxy=n.proxy||{},"string"==typeof this._proxy&&(this._proxy={origin:this._proxy});var o=n.websocketExtensions;if(o){o=[].concat(o);for(var a=0,i=o.length;i>a;a++)this.addWebsocketExtension(o[a])}this.tls=n.tls||{},this.tls.ca=this.tls.ca||n.ca;for(var r in this._alternates)this._alternates[r]=Faye.URI.parse(this._alternates[r]);this.maxRequestSize=this.MAX_REQUEST_SIZE},endpointFor:function(e){return this._alternates[e]||this.endpoint},addWebsocketExtension:function(e){this.wsExtensions.push(e)},disable:function(e){this._disabled.push(e)},setHeader:function(e,t){this.headers[e]=t},close:function(){var e=this._transport;delete this._transport,e&&e.close()},getConnectionTypes:function(){return Faye.Transport.getConnectionTypes()},selectTransport:function(e){Faye.Transport.get(this,e,this._disabled,function(e){this.debug("Selected ? transport for ?",e.connectionType,Faye.URI.stringify(e.endpoint)),e!==this._transport&&(this._transport&&this._transport.close(),this._transport=e,this.connectionType=e.connectionType)},this)},sendMessage:function(e,t,n){n=n||{};var o,a=e.id,i=n.attempts,r=n.deadline&&(new Date).getTime()+1e3*n.deadline,s=this._envelopes[a];s||(o=new this._scheduler(e,{timeout:t,interval:this.retry,attempts:i,deadline:r}),s=this._envelopes[a]={message:e,scheduler:o}),this._sendEnvelope(s)},_sendEnvelope:function(e){if(this._transport&&!e.request&&!e.timer){var t=e.message,n=e.scheduler,o=this;if(!n.isDeliverable())return n.abort(),void delete this._envelopes[t.id];e.timer=Faye.ENV.setTimeout(function(){o.handleError(t)},1e3*n.getTimeout()),n.send(),e.request=this._transport.sendMessage(t)}},handleResponse:function(e){var t=this._envelopes[e.id];void 0!==e.successful&&t&&(t.scheduler.succeed(),delete this._envelopes[e.id],Faye.ENV.clearTimeout(t.timer)),this.trigger("message",e),this._state!==this.UP&&(this._state=this.UP,this._client.trigger("transport:up"))},handleError:function(e,t){var n=this._envelopes[e.id],o=n&&n.request,a=this;if(o){o.then(function(e){e&&e.abort&&e.abort()});var i=n.scheduler;i.fail(),Faye.ENV.clearTimeout(n.timer),n.request=n.timer=null,t?this._sendEnvelope(n):n.timer=Faye.ENV.setTimeout(function(){n.timer=null,a._sendEnvelope(n)},1e3*i.getInterval()),this._state!==this.DOWN&&(this._state=this.DOWN,this._client.trigger("transport:down"))}}}),Faye.extend(Faye.Dispatcher.prototype,Faye.Publisher),Faye.extend(Faye.Dispatcher.prototype,Faye.Logging),Faye.Scheduler=function(e,t){this.message=e,this.options=t,this.attempts=0},Faye.extend(Faye.Scheduler.prototype,{getTimeout:function(){return this.options.timeout},getInterval:function(){return this.options.interval},isDeliverable:function(){var e=this.options.attempts,t=this.attempts,n=this.options.deadline,o=(new Date).getTime();return!(void 0!==e&&t>=e)&&!(void 0!==n&&o>n)},send:function(){this.attempts+=1},succeed:function(){},fail:function(){},abort:function(){}}),Faye.Transport=Faye.extend(Faye.Class({DEFAULT_PORTS:{"http:":80,"https:":443,"ws:":80,"wss:":443},SECURE_PROTOCOLS:["https:","wss:"],MAX_DELAY:0,batching:!0,initialize:function(e,t){this._dispatcher=e,this.endpoint=t,this._outbox=[],this._proxy=Faye.extend({},this._dispatcher.proxy),!this._proxy.origin&&Faye.NodeAdapter&&(this._proxy.origin=Faye.indexOf(this.SECURE_PROTOCOLS,this.endpoint.protocol)>=0?process.env.HTTPS_PROXY||process.env.https_proxy:process.env.HTTP_PROXY||process.env.http_proxy)},close:function(){},encode:function(){return""},sendMessage:function(e){return this.debug("Client ? sending message to ?: ?",this._dispatcher.clientId,Faye.URI.stringify(this.endpoint),e),this.batching?(this._outbox.push(e),this._promise=this._promise||new Faye.Promise,this._flushLargeBatch(),e.channel===Faye.Channel.HANDSHAKE?(this.addTimeout("publish",.01,this._flush,this),this._promise):(e.channel===Faye.Channel.CONNECT&&(this._connectMessage=e),this.addTimeout("publish",this.MAX_DELAY,this._flush,this),
this._promise)):Faye.Promise.fulfilled(this.request([e]))},_flush:function(){this.removeTimeout("publish"),this._outbox.length>1&&this._connectMessage&&(this._connectMessage.advice={timeout:0}),Faye.Promise.fulfill(this._promise,this.request(this._outbox)),delete this._promise,this._connectMessage=null,this._outbox=[]},_flushLargeBatch:function(){if(!(this.encode(this._outbox).length<this._dispatcher.maxRequestSize)){var e=this._outbox.pop();this._flush(),e&&this._outbox.push(e)}},_receive:function(e){if(e){e=[].concat(e),this.debug("Client ? received from ? via ?: ?",this._dispatcher.clientId,Faye.URI.stringify(this.endpoint),this.connectionType,e);for(var t=0,n=e.length;n>t;t++)this._dispatcher.handleResponse(e[t])}},_handleError:function(e){e=[].concat(e),this.debug("Client ? failed to send to ? via ?: ?",this._dispatcher.clientId,Faye.URI.stringify(this.endpoint),this.connectionType,e);for(var t=0,n=e.length;n>t;t++)this._dispatcher.handleError(e[t])},_getCookies:function(){var e=this._dispatcher.cookies,t=Faye.URI.stringify(this.endpoint);return e?Faye.map(e.getCookiesSync(t),function(e){return e.cookieString()}).join("; "):""},_storeCookies:function(e){var t,n=this._dispatcher.cookies,o=Faye.URI.stringify(this.endpoint);if(e&&n){e=[].concat(e);for(var a=0,i=e.length;i>a;a++)t=Faye.Cookies.Cookie.parse(e[a]),n.setCookieSync(t,o)}}}),{get:function(e,t,n,o,a){var i=e.endpoint;Faye.asyncEach(this._transports,function(i,r){var s=i[0],l=i[1],c=e.endpointFor(s);return Faye.indexOf(n,s)>=0?r():Faye.indexOf(t,s)<0?(l.isUsable(e,c,function(){}),r()):void l.isUsable(e,c,function(t){if(!t)return r();var n=l.hasOwnProperty("create")?l.create(e,c):new l(e,c);o.call(a,n)})},function(){throw Error("Could not find a usable connection type for "+Faye.URI.stringify(i))})},register:function(e,t){this._transports.push([e,t]),t.prototype.connectionType=e},getConnectionTypes:function(){return Faye.map(this._transports,function(e){return e[0]})},_transports:[]}),Faye.extend(Faye.Transport.prototype,Faye.Logging),Faye.extend(Faye.Transport.prototype,Faye.Timeouts),Faye.Event={_registry:[],on:function(e,t,n,o){var a=function(){n.call(o)};e.addEventListener?e.addEventListener(t,a,!1):e.attachEvent("on"+t,a),this._registry.push({_element:e,_type:t,_callback:n,_context:o,_handler:a})},detach:function(e,t,n,o){for(var a,i=this._registry.length;i--;)a=this._registry[i],e&&e!==a._element||t&&t!==a._type||n&&n!==a._callback||o&&o!==a._context||(a._element.removeEventListener?a._element.removeEventListener(a._type,a._handler,!1):a._element.detachEvent("on"+a._type,a._handler),this._registry.splice(i,1),a=null)}},void 0!==Faye.ENV.onunload&&Faye.Event.on(Faye.ENV,"unload",Faye.Event.detach,Faye.Event),"object"!=typeof JSON&&(JSON={}),function(){function f(e){return 10>e?"0"+e:e}function quote(e){return escapable.lastIndex=0,escapable.test(e)?'"'+e.replace(escapable,function(e){var t=meta[e];return"string"==typeof t?t:"\\u"+("0000"+e.charCodeAt(0).toString(16)).slice(-4)})+'"':'"'+e+'"'}function str(e,t){var n,o,a,i,r,s=gap,l=t[e];switch(l&&"object"==typeof l&&"function"==typeof l.toJSON&&(l=l.toJSON(e)),"function"==typeof rep&&(l=rep.call(t,e,l)),typeof l){case"string":return quote(l);case"number":return isFinite(l)?l+"":"null";case"boolean":case"null":return l+"";case"object":if(!l)return"null";if(gap+=indent,r=[],"[object Array]"===Object.prototype.toString.apply(l)){for(i=l.length,n=0;i>n;n+=1)r[n]=str(n,l)||"null";return a=0===r.length?"[]":gap?"[\n"+gap+r.join(",\n"+gap)+"\n"+s+"]":"["+r.join(",")+"]",gap=s,a}if(rep&&"object"==typeof rep)for(i=rep.length,n=0;i>n;n+=1)"string"==typeof rep[n]&&(o=rep[n],(a=str(o,l))&&r.push(quote(o)+(gap?": ":":")+a));else for(o in l)Object.prototype.hasOwnProperty.call(l,o)&&(a=str(o,l))&&r.push(quote(o)+(gap?": ":":")+a);return a=0===r.length?"{}":gap?"{\n"+gap+r.join(",\n"+gap)+"\n"+s+"}":"{"+r.join(",")+"}",gap=s,a}}"function"!=typeof Date.prototype.toJSON&&(Date.prototype.toJSON=function(){return isFinite(this.valueOf())?this.getUTCFullYear()+"-"+f(this.getUTCMonth()+1)+"-"+f(this.getUTCDate())+"T"+f(this.getUTCHours())+":"+f(this.getUTCMinutes())+":"+f(this.getUTCSeconds())+"Z":null},String.prototype.toJSON=Number.prototype.toJSON=Boolean.prototype.toJSON=function(){return this.valueOf()});var cx=/[\u0000\u00ad\u0600-\u0604\u070f\u17b4\u17b5\u200c-\u200f\u2028-\u202f\u2060-\u206f\ufeff\ufff0-\uffff]/g,escapable=/[\\\"\x00-\x1f\x7f-\x9f\u00ad\u0600-\u0604\u070f\u17b4\u17b5\u200c-\u200f\u2028-\u202f\u2060-\u206f\ufeff\ufff0-\uffff]/g,gap,indent,meta={"\b":"\\b","\t":"\\t","\n":"\\n","\f":"\\f","\r":"\\r",'"':'\\"',"\\":"\\\\"},rep;Faye.stringify=function(e,t,n){var o;if(gap="",indent="","number"==typeof n)for(o=0;n>o;o+=1)indent+=" ";else"string"==typeof n&&(indent=n);if(rep=t,t&&"function"!=typeof t&&("object"!=typeof t||"number"!=typeof t.length))throw Error("JSON.stringify");return str("",{"":e})},"function"!=typeof JSON.stringify&&(JSON.stringify=Faye.stringify),"function"!=typeof JSON.parse&&(JSON.parse=function(text,reviver){function walk(e,t){var n,o,a=e[t];if(a&&"object"==typeof a)for(n in a)Object.prototype.hasOwnProperty.call(a,n)&&(o=walk(a,n),void 0!==o?a[n]=o:delete a[n]);return reviver.call(e,t,a)}var j;if(text+="",cx.lastIndex=0,cx.test(text)&&(text=text.replace(cx,function(e){return"\\u"+("0000"+e.charCodeAt(0).toString(16)).slice(-4)})),/^[\],:{}\s]*$/.test(text.replace(/\\(?:["\\\/bfnrt]|u[0-9a-fA-F]{4})/g,"@").replace(/"[^"\\\n\r]*"|true|false|null|-?\d+(?:\.\d*)?(?:[eE][+\-]?\d+)?/g,"]").replace(/(?:^|:|,)(?:\s*\[)+/g,"")))return j=eval("("+text+")"),"function"==typeof reviver?walk({"":j},""):j;throw new SyntaxError("JSON.parse")})}(),Faye.Transport.WebSocket=Faye.extend(Faye.Class(Faye.Transport,{UNCONNECTED:1,CONNECTING:2,CONNECTED:3,batching:!1,isUsable:function(e,t){this.callback(function(){e.call(t,!0)}),this.errback(function(){e.call(t,!1)}),this.connect()},request:function(e){this._pending=this._pending||new Faye.Set;for(var t=0,n=e.length;n>t;t++)this._pending.add(e[t]);var o=new Faye.Promise;return this.callback(function(t){t&&1===t.readyState&&(t.send(Faye.toJSON(e)),Faye.Promise.fulfill(o,t))},this),this.connect(),{abort:function(){o.then(function(e){e.close()})}}},connect:function(){if(!Faye.Transport.WebSocket._unloaded&&(this._state=this._state||this.UNCONNECTED,this._state===this.UNCONNECTED)){this._state=this.CONNECTING;var e=this._createSocket();if(!e)return this.setDeferredStatus("failed");var t=this;e.onopen=function(){e.headers&&t._storeCookies(e.headers["set-cookie"]),t._socket=e,t._state=t.CONNECTED,t._everConnected=!0,t._ping(),t.setDeferredStatus("succeeded",e)};var n=!1;e.onclose=e.onerror=function(){if(!n){n=!0;var o=t._state===t.CONNECTED;e.onopen=e.onclose=e.onerror=e.onmessage=null,delete t._socket,t._state=t.UNCONNECTED,t.removeTimeout("ping"),t.setDeferredStatus("unknown");var a=t._pending?t._pending.toArray():[];delete t._pending,o?t._handleError(a,!0):t._everConnected?t._handleError(a):t.setDeferredStatus("failed")}},e.onmessage=function(e){var n=JSON.parse(e.data);if(n){n=[].concat(n);for(var o=0,a=n.length;a>o;o++)void 0!==n[o].successful&&t._pending.remove(n[o]);t._receive(n)}}}},close:function(){this._socket&&this._socket.close()},_createSocket:function(){var e=Faye.Transport.WebSocket.getSocketUrl(this.endpoint),t=this._dispatcher.headers,n=this._dispatcher.wsExtensions,o=this._getCookies(),a=this._dispatcher.tls,i={extensions:n,headers:t,proxy:this._proxy,tls:a};return""!==o&&(i.headers.Cookie=o),Faye.WebSocket?new Faye.WebSocket.Client(e,[],i):Faye.ENV.MozWebSocket?new MozWebSocket(e):Faye.ENV.WebSocket?new WebSocket(e):void 0},_ping:function(){this._socket&&(this._socket.send("[]"),this.addTimeout("ping",this._dispatcher.timeout/2,this._ping,this))}}),{PROTOCOLS:{"http:":"ws:","https:":"wss:"},create:function(e,t){var n=e.transports.websocket=e.transports.websocket||{};return n[t.href]=n[t.href]||new this(e,t),n[t.href]},getSocketUrl:function(e){return e=Faye.copyObject(e),e.protocol=this.PROTOCOLS[e.protocol],Faye.URI.stringify(e)},isUsable:function(e,t,n,o){this.create(e,t).isUsable(n,o)}}),Faye.extend(Faye.Transport.WebSocket.prototype,Faye.Deferrable),Faye.Transport.register("websocket",Faye.Transport.WebSocket),Faye.Event&&void 0!==Faye.ENV.onbeforeunload&&Faye.Event.on(Faye.ENV,"beforeunload",function(){Faye.Transport.WebSocket._unloaded=!0}),Faye.Transport.EventSource=Faye.extend(Faye.Class(Faye.Transport,{initialize:function(e,t){if(Faye.Transport.prototype.initialize.call(this,e,t),!Faye.ENV.EventSource)return this.setDeferredStatus("failed");this._xhr=new Faye.Transport.XHR(e,t),t=Faye.copyObject(t),t.pathname+="/"+e.clientId;var n=new EventSource(Faye.URI.stringify(t)),o=this;n.onopen=function(){o._everConnected=!0,o.setDeferredStatus("succeeded")},n.onerror=function(){o._everConnected?o._handleError([]):(o.setDeferredStatus("failed"),n.close())},n.onmessage=function(e){o._receive(JSON.parse(e.data))},this._socket=n},close:function(){this._socket&&(this._socket.onopen=this._socket.onerror=this._socket.onmessage=null,this._socket.close(),delete this._socket)},isUsable:function(e,t){this.callback(function(){e.call(t,!0)}),this.errback(function(){e.call(t,!1)})},encode:function(e){return this._xhr.encode(e)},request:function(e){return this._xhr.request(e)}}),{isUsable:function(e,t,n,o){return e.clientId?void Faye.Transport.XHR.isUsable(e,t,function(a){return a?void this.create(e,t).isUsable(n,o):n.call(o,!1)},this):n.call(o,!1)},create:function(e,t){var n=e.transports.eventsource=e.transports.eventsource||{},o=e.clientId,a=Faye.copyObject(t);return a.pathname+="/"+(o||""),a=Faye.URI.stringify(a),n[a]=n[a]||new this(e,t),n[a]}}),Faye.extend(Faye.Transport.EventSource.prototype,Faye.Deferrable),Faye.Transport.register("eventsource",Faye.Transport.EventSource),Faye.Transport.XHR=Faye.extend(Faye.Class(Faye.Transport,{encode:function(e){return Faye.toJSON(e)},request:function(e){var t=this.endpoint.href,n=Faye.ENV.ActiveXObject?new ActiveXObject("Microsoft.XMLHTTP"):new XMLHttpRequest,o=this;n.open("POST",t,!0),n.setRequestHeader("Content-Type","application/json"),n.setRequestHeader("Pragma","no-cache"),n.setRequestHeader("X-Requested-With","XMLHttpRequest");var a=this._dispatcher.headers;for(var i in a)a.hasOwnProperty(i)&&n.setRequestHeader(i,a[i]);var r=function(){n.abort()};return void 0!==Faye.ENV.onbeforeunload&&Faye.Event.on(Faye.ENV,"beforeunload",r),n.onreadystatechange=function(){if(n&&4===n.readyState){var t=null,a=n.status,i=n.responseText,s=a>=200&&300>a||304===a||1223===a;if(void 0!==Faye.ENV.onbeforeunload&&Faye.Event.detach(Faye.ENV,"beforeunload",r),n.onreadystatechange=function(){},n=null,!s)return o._handleError(e);try{t=JSON.parse(i)}catch(e){}t?o._receive(t):o._handleError(e)}},n.send(this.encode(e)),n}}),{isUsable:function(e,t,n,o){n.call(o,Faye.URI.isSameOrigin(t))}}),Faye.Transport.register("long-polling",Faye.Transport.XHR),Faye.Transport.CORS=Faye.extend(Faye.Class(Faye.Transport,{encode:function(e){return"message="+encodeURIComponent(Faye.toJSON(e))},request:function(e){var t,n=Faye.ENV.XDomainRequest?XDomainRequest:XMLHttpRequest,o=new n,a=++Faye.Transport.CORS._id,i=this._dispatcher.headers,r=this;if(o.open("POST",Faye.URI.stringify(this.endpoint),!0),o.setRequestHeader){o.setRequestHeader("Pragma","no-cache");for(t in i)i.hasOwnProperty(t)&&o.setRequestHeader(t,i[t])}var s=function(){return!!o&&(Faye.Transport.CORS._pending.remove(a),o.onload=o.onerror=o.ontimeout=o.onprogress=null,void(o=null))};return o.onload=function(){var t=null;try{t=JSON.parse(o.responseText)}catch(e){}s(),t?r._receive(t):r._handleError(e)},o.onerror=o.ontimeout=function(){s(),r._handleError(e)},o.onprogress=function(){},n===Faye.ENV.XDomainRequest&&Faye.Transport.CORS._pending.add({id:a,xhr:o}),o.send(this.encode(e)),o}}),{_id:0,_pending:new Faye.Set,isUsable:function(e,t,n,o){if(Faye.URI.isSameOrigin(t))return n.call(o,!1);if(Faye.ENV.XDomainRequest)return n.call(o,t.protocol===Faye.ENV.location.protocol);if(Faye.ENV.XMLHttpRequest){var a=new Faye.ENV.XMLHttpRequest;return n.call(o,void 0!==a.withCredentials)}return n.call(o,!1)}}),Faye.Transport.register("cross-origin-long-polling",Faye.Transport.CORS),Faye.Transport.JSONP=Faye.extend(Faye.Class(Faye.Transport,{encode:function(e){var t=Faye.copyObject(this.endpoint);return t.query.message=Faye.toJSON(e),t.query.jsonp="__jsonp"+Faye.Transport.JSONP._cbCount+"__",Faye.URI.stringify(t)},request:function(e){var t=document.getElementsByTagName("head")[0],n=document.createElement("script"),o=Faye.Transport.JSONP.getCallbackName(),a=Faye.copyObject(this.endpoint),i=this;a.query.message=Faye.toJSON(e),a.query.jsonp=o;var r=function(){if(!Faye.ENV[o])return!1;Faye.ENV[o]=void 0;try{delete Faye.ENV[o]}catch(e){}n.parentNode.removeChild(n)};return Faye.ENV[o]=function(e){r(),i._receive(e)},n.type="text/javascript",n.src=Faye.URI.stringify(a),t.appendChild(n),n.onerror=function(){r(),i._handleError(e)},{abort:r}}}),{_cbCount:0,getCallbackName:function(){return this._cbCount+=1,"__jsonp"+this._cbCount+"__"},isUsable:function(e,t,n,o){n.call(o,!0)}}),Faye.Transport.register("callback-polling",Faye.Transport.JSONP)}()}(this),function(){var e=document.createElement("script");e.type="text/javascript",e.src="https://browser.sentry-cdn.com/4.5.2/bundle.min.js",e.async=!0,document.getElementsByTagName("head")[0].appendChild(e),e.addEventListener("load",function(){Sentry.init({dsn:"https://8e10bd6612424e0392f67c1cf8b0b0b7@sentry.io/1269259",defaultIntegrations:!1})})}(window);var allokaDevelopment=!1;window.allokaWhiteLabelScript=!1,window.allokaDefaultServerHost="analytics.alloka.ru",window.allokaSessionCookieName="alloka_session",window.allokaAllokaIdPath="/api/site/allokaid/",window.allokaAllokaIdCookieName="allokaid",window.allokaAllokaIdReq="alloka_id",window.allokaAllokaIdRes="allokaid",allokaBindReady(allokaInit),geoInit(),allokaWhiteLabelScript||loadModal();var allokaIsNewSendGaClientIdList=["nskcvd.ru","pansion-medvedkovo.ru","\u043a\u0430\u0447\u0435\u0441\u0442\u0432\u0435\u043d\u043d\u044b\u0435-\u043f\u043e\u0442\u043e\u043b\u043a\u0438.\u0440\u0444","localhost"];"undefined"==typeof window._alloka_defer&&(window._alloka_defer={});var allokaSendCustomData=allokaSendCustomDataDefer;document.getElementsByClassName||(document.getElementsByClassName=function(e){for(var t=[],n=document.getElementsByTagName("*"),o=new RegExp("(^|\\s)"+e+"(\\s|$)"),a=0;a<n.length;a++)o.test(n[a].className)&&t.push(n[a]);return t}),"indexOf"in Array.prototype||(Array.prototype.indexOf=function(e,t){t===undefined&&(t=0),t<0&&(t+=this.length),t<0&&(t=0);for(var n=this.length;t<n;t++)if(t in this&&this[t]===e)return t;return-1}),"function"!=typeof String.prototype.trim&&(String.prototype.trim=function(){return this.replace(/^\s+|\s+$/g,"")});try{var Base64={_keyStr:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",encode:function(e){var t,n,o,a,i,r,s,l="",c=0;for(e=Base64._utf8_encode(e);c<e.length;)t=e.charCodeAt(c++),n=e.charCodeAt(c++),o=e.charCodeAt(c++),a=t>>2,i=(3&t)<<4|n>>4,r=(15&n)<<2|o>>6,s=63&o,isNaN(n)?r=s=64:isNaN(o)&&(s=64),l=l+Base64._keyStr.charAt(a)+Base64._keyStr.charAt(i)+Base64._keyStr.charAt(r)+Base64._keyStr.charAt(s);return l},decode:function(e){var t,n,o,a,i,r,s,l="",c=0;for(e=e.replace(/[^A-Za-z0-9\+\/\=]/g,"");c<e.length;)a=Base64._keyStr.indexOf(e.charAt(c++)),i=Base64._keyStr.indexOf(e.charAt(c++)),r=Base64._keyStr.indexOf(e.charAt(c++)),s=Base64._keyStr.indexOf(e.charAt(c++)),t=a<<2|i>>4,n=(15&i)<<4|r>>2,o=(3&r)<<6|s,l+=String.fromCharCode(t),64!=r&&(l+=String.fromCharCode(n)),64!=s&&(l+=String.fromCharCode(o));return l=Base64._utf8_decode(l)},_utf8_encode:function(e){e=e.replace(/\r\n/g,"\n");for(var t="",n=0;n<e.length;n++){var o=e.charCodeAt(n);o<128?t+=String.fromCharCode(o):o>127&&o<2048?(t+=String.fromCharCode(o>>6|192),t+=String.fromCharCode(63&o|128)):(t+=String.fromCharCode(o>>12|224),t+=String.fromCharCode(o>>6&63|128),t+=String.fromCharCode(63&o|128))}return t},_utf8_decode:function(e){for(var t="",n=0,o=c1=c2=0;n<e.length;)o=e.charCodeAt(n),o<128?(t+=String.fromCharCode(o),n++):o>191&&o<224?(c2=e.charCodeAt(n+1),t+=String.fromCharCode((31&o)<<6|63&c2),n+=2):(c2=e.charCodeAt(n+1),c3=e.charCodeAt(n+2),t+=String.fromCharCode((15&o)<<12|(63&c2)<<6|63&c3),n+=3);return t}};"object"!=typeof JSON&&(JSON={}),function(){"use strict";function f(e){return e<10?"0"+e:e}function quote(e){return escapable.lastIndex=0,escapable.test(e)?'"'+e.replace(escapable,function(e){var t=meta[e];return"string"==typeof t?t:"\\u"+("0000"+e.charCodeAt(0).toString(16)).slice(-4)})+'"':'"'+e+'"'}function str(e,t){var n,o,a,i,r,s=gap,l=t[e];switch(l&&"object"==typeof l&&"function"==typeof l.toJSON&&(l=l.toJSON(e)),"function"==typeof rep&&(l=rep.call(t,e,l)),typeof l){case"string":return quote(l);case"number":return isFinite(l)?String(l):"null";case"boolean":case"null":return String(l);case"object":if(!l)return"null";if(gap+=indent,r=[],"[object Array]"===Object.prototype.toString.apply(l)){for(i=l.length,n=0;n<i;n+=1)r[n]=str(n,l)||"null";return a=0===r.length?"[]":gap?"[\n"+gap+r.join(",\n"+gap)+"\n"+s+"]":"["+r.join(",")+"]",gap=s,a}if(rep&&"object"==typeof rep)for(i=rep.length,n=0;n<i;n+=1)"string"==typeof rep[n]&&(o=rep[n],(a=str(o,l))&&r.push(quote(o)+(gap?": ":":")+a));else for(o in l)Object.prototype.hasOwnProperty.call(l,o)&&(a=str(o,l))&&r.push(quote(o)+(gap?": ":":")+a);return a=0===r.length?"{}":gap?"{\n"+gap+r.join(",\n"+gap)+"\n"+s+"}":"{"+r.join(",")+"}",gap=s,a}}"function"!=typeof Date.prototype.toJSON&&(Date.prototype.toJSON=function(){return isFinite(this.valueOf())?this.getUTCFullYear()+"-"+f(this.getUTCMonth()+1)+"-"+f(this.getUTCDate())+"T"+f(this.getUTCHours())+":"+f(this.getUTCMinutes())+":"+f(this.getUTCSeconds())+"Z":null},String.prototype.toJSON=Number.prototype.toJSON=Boolean.prototype.toJSON=function(){return this.valueOf()});var cx,escapable,gap,indent,meta,rep;"function"!=typeof JSON.stringify&&(escapable=/[\\\"\x00-\x1f\x7f-\x9f\u00ad\u0600-\u0604\u070f\u17b4\u17b5\u200c-\u200f\u2028-\u202f\u2060-\u206f\ufeff\ufff0-\uffff]/g,meta={"\b":"\\b","\t":"\\t","\n":"\\n","\f":"\\f","\r":"\\r",'"':'\\"',"\\":"\\\\"},JSON.stringify=function(e,t,n){var o;if(gap="",indent="","number"==typeof n)for(o=0;o<n;o+=1)indent+=" ";else"string"==typeof n&&(indent=n);if(rep=t,t&&"function"!=typeof t&&("object"!=typeof t||"number"!=typeof t.length))throw new Error("JSON.stringify");return str("",{"":e})}),"function"!=typeof JSON.parse&&(cx=/[\u0000\u00ad\u0600-\u0604\u070f\u17b4\u17b5\u200c-\u200f\u2028-\u202f\u2060-\u206f\ufeff\ufff0-\uffff]/g,JSON.parse=function(text,reviver){function walk(e,t){var n,o,a=e[t];if(a&&"object"==typeof a)for(n in a)Object.prototype.hasOwnProperty.call(a,n)&&(o=walk(a,n),o!==undefined?a[n]=o:delete a[n]);return reviver.call(e,t,a)}var j;if(text=String(text),cx.lastIndex=0,cx.test(text)&&(text=text.replace(cx,function(e){return"\\u"+("0000"+e.charCodeAt(0).toString(16)).slice(-4)})),/^[\],:{}\s]*$/.test(text.replace(/\\(?:["\\\/bfnrt]|u[0-9a-fA-F]{4})/g,"@").replace(/"[^"\\\n\r]*"|true|false|null|-?\d+(?:\.\d*)?(?:[eE][+\-]?\d+)?/g,"]").replace(/(?:^|:|,)(?:\s*\[)+/g,"")))return j=eval("("+text+")"),"function"==typeof reviver?walk({"":j},""):j;throw new SyntaxError("JSON.parse")})}()}catch(e){allokaLog(e)}!function(){function e(e){this.message=e}var t="undefined"!=typeof exports?exports:"undefined"!=typeof self?self:$.global,n="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=";e.prototype=new Error,e.prototype.name="InvalidCharacterError",t.btoa||(t.btoa=function(t){for(var o,a,i=String(t),r=0,s=n,l="";i.charAt(0|r)||(s="=",r%1);l+=s.charAt(63&o>>8-r%1*8)){if((a=i.charCodeAt(r+=.75))>255)throw new e("'btoa' failed: The string to be encoded contains characters outside of the Latin1 range.");o=o<<8|a}return l}),t.atob||(t.atob=function(t){var o=String(t).replace(/[=]+$/,"");if(o.length%4==1)throw new e("'atob' failed: The string to be decoded is not correctly encoded.");for(var a,i,r=0,s=0,l="";i=o.charAt(s++);~i&&(a=r%4?64*a+i:i,r++%4)?l+=String.fromCharCode(255&a>>(-2*r&6)):0)i=n.indexOf(i);return l})}(),function(){function e(){if(allokaWhiteLabelScript){var e=atob("YWxsb2thaWQ=");allokaGetCookie(e)&&!allokaGetCookie(allokaAllokaIdCookieName)&&allokaSetCookie(allokaAllokaIdCookieName,allokaGetCookie(e))}}window.allokaAllokaIdMigrateWhiteLabel=e}();/*!
 * jsModal - A pure JavaScript modal dialog engine v1.0d
 * http://jsmodal.com/
 *
 * Author: Henry Rune Tang Kai <henry@henrys.se>
 *
 * (c) Copyright 2013 Henry Tang Kai.
 *
 * License: http://www.opensource.org/licenses/mit-license.php
 *
 * Date: 2013-7-11
 */
var Modal=function(){"use strict";var e,t,n={},o={},a=document.createElement("div"),i=document.createElement("div"),r=document.createElement("div"),s=document.createElement("div"),l=document.createElement("div"),c={width:"auto",height:"auto",lock:!1,hideClose:!1,draggable:!1,closeAfter:0,openCallback:!1,closeCallback:!1,hideOverlay:!1};return n.open=function(d){o.width=d.width||c.width,o.height=d.height||c.height,o.lock=d.lock||c.lock,o.hideClose=d.hideClose||c.hideClose,o.draggable=d.draggable||c.draggable,o.closeAfter=d.closeAfter||c.closeAfter,o.closeCallback=d.closeCallback||c.closeCallback,o.openCallback=d.openCallback||c.openCallback,o.hideOverlay=d.hideOverlay||c.hideOverlay,e=function(){n.center({})},d.content&&!d.ajaxContent?s.innerHTML=d.content:d.ajaxContent&&!d.content?(i.className="modal-loading",n.ajax(d.ajaxContent,function(e){s.innerHTML=e})):s.innerHTML="",i.style.width=o.width,i.style.height=o.height,n.center({}),(o.lock||o.hideClose)&&(l.style.visibility="hidden"),o.hideOverlay||(a.style.visibility="visible"),i.style.display=null,e(),document.onkeypress=function(e){27===e.keyCode&&!0!==o.lock&&n.close()},l.onclick=function(){if(o.hideClose)return!1;n.close()},a.onclick=function(){if(o.lock)return!1;n.close()},window.addEventListener?window.addEventListener("resize",e,!1):window.attachEvent&&window.attachEvent("onresize",e),o.draggable?(r.style.cursor="move",r.onmousedown=function(e){return n.drag(e),!1}):r.onmousedown=function(){return!1},o.closeAfter>0&&(t=window.setTimeout(function(){n.close()},1e3*o.closeAfter)),o.openCallback&&o.openCallback()},n.drag=function(e){var t=window.event!==undefined?window.event.clientX:e.clientX,n=window.event!==undefined?window.event.clientY:e.clientY,o=t-i.offsetLeft,a=n-i.offsetTop;document.onmousemove=function(e){t=window.event!==undefined?window.event.clientX:e.clientX,n=window.event!==undefined?window.event.clientY:e.clientY,i.style.left=t-o>0?t-o+"px":0,i.style.top=n-a>0?n-a+"px":0,document.onmouseup=function(){window.document.onmousemove=null}}},n.ajax=function(e,t){var n,o=!1,a=[function(){return new window.XMLHttpRequest},function(){return new window.ActiveXObject("Msxml2.XMLHTTP.6.0")},function(){return new window.ActiveXObject("Msxml2.XMLHTTP.3.0")},function(){return new window.ActiveXObject("Msxml2.XMLHTTP")}];for(n=0;n<a.length;n+=1){try{o=a[n]()}catch(e){}if(!1!==o)break}o.open("GET",e,!0),o.onreadystatechange=function(){4===o.readyState&&(o.status,t(o.responseText),i.removeAttribute("class"))},o.send(null)},n.close=function(){s.innerHTML="",a.setAttribute("style",""),a.style.cssText="",a.style.visibility="hidden",i.setAttribute("style",""),i.style.cssText="",i.style.display="none",r.style.cursor="default",l.setAttribute("style",""),l.style.cssText="",t&&window.clearTimeout(t),o.closeCallback&&o.closeCallback(),window.removeEventListener?window.removeEventListener("resize",e,!1):window.detachEvent&&window.detachEvent("onresize",e)},n.center=function(e){var t=Math.max(document.body.scrollHeight,document.documentElement.scrollHeight),n=Math.max(i.clientWidth,i.offsetWidth),o=Math.max(i.clientHeight,i.offsetHeight),r=0,s=0,l=0,c=0;"number"==typeof window.innerWidth?(r=window.innerWidth,s=window.innerHeight):document.documentElement&&document.documentElement.clientWidth&&(r=document.documentElement.clientWidth,s=document.documentElement.clientHeight),"number"==typeof window.pageYOffset?(c=window.pageYOffset,l=window.pageXOffset):document.body&&document.body.scrollLeft?(c=document.body.scrollTop,l=document.body.scrollLeft):document.documentElement&&document.documentElement.scrollLeft&&(c=document.documentElement.scrollTop,l=document.documentElement.scrollLeft),e.horizontalOnly||(i.style.top=c+s/2-o/2+"px"),i.style.left=l+r/2-n/2+"px",a.style.height=t+"px",a.style.width="100%"},a.setAttribute("id","alloka-modal-overlay"),i.setAttribute("id","alloka-modal-container"),r.setAttribute("id","alloka-modal-header"),s.setAttribute("id","alloka-modal-content"),l.setAttribute("id","alloka-modal-close"),r.appendChild(l),i.appendChild(r),i.appendChild(s),a.style.visibility="hidden",i.style.display="none",window.addEventListener?window.addEventListener("load",function(){document.body.appendChild(a),document.body.appendChild(i)},!1):window.attachEvent&&window.attachEvent("onload",function(){document.body.appendChild(a),document.body.appendChild(i)}),n}();window.jivo_onLoadCallback||(window.jivo_onLoadCallback=function(){setTimeout(set_jivosite_data,3e3)}),function(){function e(e){var n=getProtocol()+_alloka.server_host,o=n+"/webhooks/calldron";e={object:e.oid,phone_number:e.phone_number,search:allokaGetSearch(),referrer:allokaGetReferrer(),request_uri:window.location.href,session_id:_alloka.objects[e.oid].session_id,user_agent:"",remote_ip:"",duration:e.duration,custom_data:JSON.stringify({text:e.text}),from_foreign_widget:!0},t.get(o,e,function(){})}window.allokaForeignWidgetCall=e;var t={};t.x=function(){if("undefined"!=typeof XMLHttpRequest)return new XMLHttpRequest;for(var e,t=["MSXML2.XmlHttp.6.0","MSXML2.XmlHttp.5.0","MSXML2.XmlHttp.4.0","MSXML2.XmlHttp.3.0","MSXML2.XmlHttp.2.0","Microsoft.XmlHttp"],n=0;n<t.length;n++)try{e=new ActiveXObject(t[n]);break}catch(e){}return e},t.send=function(e,n,o,a,i){i===undefined&&(i=!0);var r=t.x();r.open(o,e,i),r.onreadystatechange=function(){4==r.readyState&&n(r.responseText)},"POST"==o&&r.setRequestHeader("Content-type","application/x-www-form-urlencoded"),r.send(a)},t.get=function(e,n,o,a){var i=[];for(var r in n)n[r]?i.push(encodeURIComponent(r)+"="+encodeURIComponent(n[r])):i.push(encodeURIComponent(r)+"=");t.send(e+(i.length?"?"+i.join("&"):""),o,"GET",null,a)}}();var translations={ru:{title:"\u0414\u043e\u0432\u043e\u043b\u044c\u043d\u044b \u043b\u0438 \u0432\u044b&nbsp;\u0440\u0430\u0437\u0433\u043e\u0432\u043e\u0440\u043e\u043c?"},en:{title:"Are you happy with the conversation?"},tr:{title:"G\xf6r\xfc\u015fmeden memnun kald\u0131n\u0131z m\u0131?"}};